# üîÑ –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´ –†–ï–í–ò–ó–ò–ò (–î–û–†–ê–ë–û–¢–ö–ò) –°–¶–ï–ù–ê–†–ò–ï–í

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2024

---

## üìã –û–ë–ó–û–† –ü–†–û–¶–ï–°–°–ê

–†–µ–≤–∏–∑–∏—è (–¥–æ—Ä–∞–±–æ—Ç–∫–∞) —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–º–µ—á–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Å—Ü–µ–Ω–∞—Ä–∏—è, —É—á–∏—Ç—ã–≤–∞—è:
- –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–µ–∫—Å—Ç —Ä–µ—Ü–µ–Ω–∑–∏–∏)
- –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è
- –ò—Å—Ç–æ—Ä–∏—é –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –∏–∑ Learning System
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ feedback learning)

---

## üé® –í–ò–ó–£–ê–õ–¨–ù–ê–Ø –°–•–ï–ú–ê FLOW

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –≠–¢–ê–ü 1: –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –û–¢–ü–†–ê–í–õ–Ø–ï–¢ –†–ï–¶–ï–ù–ó–ò–Æ                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  UI: revision-dialog.tsx            ‚îÇ
        ‚îÇ  - –í—ã–±–æ—Ä —Å—Ü–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)         ‚îÇ
        ‚îÇ  - –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ —Ä–µ—Ü–µ–Ω–∑–∏–∏             ‚îÇ
        ‚îÇ  - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã                   ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
        POST /api/auto-scripts/:id/revise
        {
          feedbackText: "–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ...",
          selectedSceneIds: [0, 2]
        }
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –≠–¢–ê–ü 2: –°–ï–†–í–ï–† –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–¢ –ó–ê–ü–†–û–°                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞                ‚îÇ
        ‚îÇ  2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è                ‚îÇ
        ‚îÇ  3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (max 5)          ‚îÇ
        ‚îÇ  4. markRevision()                   ‚îÇ
        ‚îÇ     - status = 'revision'            ‚îÇ
        ‚îÇ     - revisionCount++                ‚îÇ
        ‚îÇ     - revisionNotes = feedbackText   ‚îÇ
        ‚îÇ  5. learningService.onRevise()       ‚îÇ
        ‚îÇ     - –°–æ–∑–¥–∞—ë—Ç feedback entry         ‚îÇ
        ‚îÇ     - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã             ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –≠–¢–ê–ü 3: –°–û–ó–î–ê–ù–ò–ï –ù–û–í–û–ì–û CONVEYOR ITEM (TODO)                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  1. –ü–æ–ª—É—á–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π item      ‚îÇ
        ‚îÇ  2. –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–µ—Ä—Å–∏–π         ‚îÇ
        ‚îÇ  3. –°–æ–∑–¥–∞—Ç—å revisionContext:        ‚îÇ
        ‚îÇ     {                                ‚îÇ
        ‚îÇ       notes: feedbackText,          ‚îÇ
        ‚îÇ       previousScriptId: script.id, ‚îÇ
        ‚îÇ       attempt: revisionCount + 1,   ‚îÇ
        ‚îÇ       previousVersions: [...],     ‚îÇ
        ‚îÇ       selectedSceneIds: [...]      ‚îÇ
        ‚îÇ     }                                ‚îÇ
        ‚îÇ  4. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π conveyor_item:     ‚îÇ
        ‚îÇ     - parentItemId = original.id    ‚îÇ
        ‚îÇ     - revisionContext = {...}       ‚îÇ
        ‚îÇ     - –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å source/analysis    ‚îÇ
        ‚îÇ       /architecture –∏–∑ parent      ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –≠–¢–ê–ü 4: –û–ë–†–ê–ë–û–¢–ö–ê –ß–ï–†–ï–ó –ö–û–ù–í–ï–ô–ï–† (–° –≠–¢–ê–ü–ê WRITER)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø—ã 1-4:              ‚îÇ
        ‚îÇ  ‚ùå Scout (–Ω–µ –Ω—É–∂–µ–Ω)                 ‚îÇ
        ‚îÇ  ‚ùå Scorer (–Ω–µ –Ω—É–∂–µ–Ω)               ‚îÇ
        ‚îÇ  ‚ùå Analyst (–Ω–µ –Ω—É–∂–µ–Ω)              ‚îÇ
        ‚îÇ  ‚ùå Architect (–Ω–µ –Ω—É–∂–µ–Ω)            ‚îÇ
        ‚îÇ                                     ‚îÇ
        ‚îÇ  ‚úÖ –ù–∞—á–∞—Ç—å —Å —ç—Ç–∞–ø–∞ 5: Writer        ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –≠–¢–ê–ü 5: WRITER AGENT –ü–ï–†–ï–ü–ò–°–´–í–ê–ï–¢ –°–¶–ï–ù–ê–†–ò–ô                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  1. –ü—Ä–æ–≤–µ—Ä–∫–∞ revisionContext         ‚îÇ
        ‚îÇ  2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ revision –ø—Ä–æ–º–ø—Ç–∞:    ‚îÇ
        ‚îÇ     - –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è         ‚îÇ
        ‚îÇ     - –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã                ‚îÇ
        ‚îÇ     - –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π                 ‚îÇ
        ‚îÇ     - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π           ‚îÇ
        ‚îÇ     - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è           ‚îÇ
        ‚îÇ  3. –í—ã–∑–æ–≤ AI (Claude Sonnet)         ‚îÇ
        ‚îÇ  4. –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞               ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –≠–¢–ê–ü 6: QC ‚Üí OPTIMIZER ‚Üí GATE                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  QC: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞              ‚îÇ
        ‚îÇ  Optimizer: –£–ª—É—á—à–µ–Ω–∏–µ —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç   ‚îÇ
        ‚îÇ  Gate: PASS / FAIL / NEEDS_REVIEW   ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –≠–¢–ê–ü 7: DELIVERY AGENT –°–û–•–†–ê–ù–Ø–ï–¢ –†–ï–ó–£–õ–¨–¢–ê–¢                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  1. –û–±–Ω–æ–≤–∏—Ç—å auto_script:            ‚îÇ
        ‚îÇ     - scenes = –Ω–æ–≤—ã–µ —Å—Ü–µ–Ω—ã          ‚îÇ
        ‚îÇ     - fullScript = –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç      ‚îÇ
        ‚îÇ     - status = 'pending'            ‚îÇ
        ‚îÇ     - scores = –Ω–æ–≤—ã–µ –æ—Ü–µ–Ω–∫–∏         ‚îÇ
        ‚îÇ  2. –°–æ–∑–¥–∞—Ç—å auto_script_version:     ‚îÇ
        ‚îÇ     - versionNumber = revisionCount ‚îÇ
        ‚îÇ     - feedbackText = –∑–∞–º–µ—á–∞–Ω–∏—è      ‚îÇ
        ‚îÇ     - isCurrent = true              ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                    ‚úÖ –ì–û–¢–û–í–û –ö –†–ï–í–¨–Æ
```

---

## üîÑ –ü–û–õ–ù–´–ô FLOW –†–ï–í–ò–ó–ò–ò

### –≠–¢–ê–ü 1: –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –û–¢–ü–†–ê–í–õ–Ø–ï–¢ –†–ï–¶–ï–ù–ó–ò–Æ

**UI:** `client/src/components/auto-scripts/revision-dialog.tsx`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ —Å—Ç–∞—Ç—É—Å–µ "pending"
2. –ù–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É"
3. –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ü–µ–Ω—ã –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –í–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç —Ä–µ—Ü–µ–Ω–∑–∏–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ä–º—É

**–ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**
```typescript
POST /api/auto-scripts/:id/revise
Body: {
  feedbackText: string,        // –¢–µ–∫—Å—Ç —Ä–µ—Ü–µ–Ω–∑–∏–∏ (1-3000 —Å–∏–º–≤–æ–ª–æ–≤)
  selectedSceneIds: number[] | null  // –ò–Ω–¥–µ–∫—Å—ã —Å—Ü–µ–Ω –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è
}
```

---

### –≠–¢–ê–ü 2: –°–ï–†–í–ï–† –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–¢ –ó–ê–ü–†–û–°

**–§–∞–π–ª:** `server/routes/auto-scripts.routes.ts:437-555`

**–®–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

#### 2.1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
const userId = getUserId(req);

// –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
const { feedbackText, selectedSceneIds } = reviseSchema.parse(req.body);
```

#### 2.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
const script = await autoScriptsStorage.getById(id);
if (!script) return 404;

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
if (script.userId !== userId) return 403;

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (–º–æ–∂–Ω–æ –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ "pending" –∏–ª–∏ "revision")
if (script.status !== "pending" && script.status !== "revision") {
  return 400; // "Script is already {status}"
}
```

#### 2.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –¥–æ—Ä–∞–±–æ—Ç–æ–∫
```typescript
const MAX_REVISIONS = 5;

if (script.revisionCount >= MAX_REVISIONS) {
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª–æ–Ω—è–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π
  await autoScriptsStorage.reject(id, "Maximum revision limit reached", RejectionCategory.OTHER);
  return 400; // "Maximum revision limit reached"
}
```

#### 2.4. –ü–æ–º–µ—á–∞–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π –∫–∞–∫ "revision"
```typescript
await autoScriptsStorage.markRevision(id, feedbackText);
// –û–±–Ω–æ–≤–ª—è–µ—Ç:
// - status = 'revision'
// - revisionNotes = feedbackText
// - revisionCount = revisionCount + 1
```

#### 2.5. –û–±–Ω–æ–≤–ª—è–µ–º Learning System
```typescript
await learningService.onRevise(userId, id, feedbackText);
// –°–æ–∑–¥–∞—ë—Ç feedback entry –¥–ª—è AI –æ–±—Ä–∞–±–æ—Ç–∫–∏
// –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ –∑–∞–º–µ—á–∞–Ω–∏–π
// –û–±–Ω–æ–≤–ª—è–µ—Ç rejection_patterns –≤ conveyor_settings
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ "revision", feedback —Å–æ—Ö—Ä–∞–Ω—ë–Ω, —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ.

---

### –≠–¢–ê–ü 3: –°–û–ó–î–ê–ù–ò–ï –ù–û–í–û–ì–û CONVEYOR ITEM (TODO)

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –°–µ–π—á–∞—Å —ç—Ç–æ—Ç —ç—Ç–∞–ø **–ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

**–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞:**

#### 3.1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```typescript
// –ü–æ–ª—É—á–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π conveyor_item
const originalItem = await conveyorItemsStorage.getById(script.conveyorItemId);

// –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (source, scoring, analysis, architecture)
const sourceData = originalItem.sourceData;
const scoringData = originalItem.scoringData;
const analysisData = originalItem.analysisData;
const architectureData = originalItem.architectureData;
```

#### 3.2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Ä—Å–∏–π
```typescript
// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
const previousVersions = await autoScriptVersionsStorage.getByScript(script.id);

// –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
const previousVersionsData = previousVersions.map(v => ({
  versionNumber: v.versionNumber,
  fullScript: v.fullScript,
  scenes: v.scenes,
  feedbackText: v.feedbackText,
}));
```

#### 3.3. –°–æ–∑–¥–∞–Ω–∏–µ revision context
```typescript
const revisionContext: RevisionContext = {
  notes: feedbackText,
  previousScriptId: script.id,
  attempt: script.revisionCount + 1,
  previousVersions: previousVersionsData,
  selectedSceneIds: selectedSceneIds || undefined,
};
```

#### 3.4. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ conveyor_item
```typescript
const newItem = await conveyorItemsStorage.create({
  userId,
  sourceType: originalItem.sourceType,
  sourceItemId: originalItem.sourceItemId,
  status: "processing",
  parentItemId: originalItem.id,  // –°–≤—è–∑—å —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º
  revisionContext: revisionContext,
});

// –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ item
await conveyorItemsStorage.updateStageData(newItem.id, STAGES.SCOUT, sourceData);
await conveyorItemsStorage.updateStageData(newItem.id, STAGES.SCORER, scoringData);
await conveyorItemsStorage.updateStageData(newItem.id, STAGES.ANALYST, analysisData);
await conveyorItemsStorage.updateStageData(newItem.id, STAGES.ARCHITECT, architectureData);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π `conveyor_item` —Å `revisionContext`, –≥–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å —ç—Ç–∞–ø–∞ Writer.

---

### –≠–¢–ê–ü 4: –û–ë–†–ê–ë–û–¢–ö–ê –ß–ï–†–ï–ó –ö–û–ù–í–ï–ô–ï–† (–° –≠–¢–ê–ü–ê WRITER)

**–§–∞–π–ª:** `server/conveyor/conveyor-orchestrator.ts`

**–õ–æ–≥–∏–∫–∞:**

#### 4.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ revision context
```typescript
// –í processItem() –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ revisionContext
const item = await conveyorItemsStorage.getById(itemId);
const revisionContext = item.revisionContext;

if (revisionContext) {
  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–∞–ø—ã 1-4 (Scout, Scorer, Analyst, Architect)
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ parent_item
  // –ù–∞—á–∏–Ω–∞–µ–º —Å —ç—Ç–∞–ø–∞ 5 (Writer)
}
```

#### 4.2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Writer
```typescript
// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ item (—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑ parent)
const sourceData = item.sourceData;
const analysis = item.analysisData;
const architecture = item.architectureData;

// –ü–æ–ª—É—á–∞–µ–º revision context
const revisionContext: EnhancedRevisionContext = {
  notes: item.revisionContext.notes,
  previousScriptId: item.revisionContext.previousScriptId,
  attempt: item.revisionContext.attempt,
  previousVersions: item.revisionContext.previousVersions,
  selectedSceneIds: item.revisionContext.selectedSceneIds,
};

// –ü–æ–ª—É—á–∞–µ–º user writing context (–∏–∑ feedback learning)
const userWritingContext = await feedbackProcessor.getWriterContext(userId);
```

#### 4.3. –í—ã–∑–æ–≤ Writer Agent
```typescript
const writerResult = await writerAgent.process({
  source: sourceData,
  analysis,
  architecture,
  rejectionPatterns: settings.rejectionPatterns,
  revisionContext: revisionContext,  // ‚Üê –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä!
  userWritingContext: userWritingContext,
}, context);
```

---

### –≠–¢–ê–ü 5: WRITER AGENT –ü–ï–†–ï–ü–ò–°–´–í–ê–ï–¢ –°–¶–ï–ù–ê–†–ò–ô

**–§–∞–π–ª:** `server/conveyor/agents/writer-agent.ts:54-86`

**–õ–æ–≥–∏–∫–∞ Writer:**

#### 5.1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø—Ä–æ–º–ø—Ç–∞
```typescript
if (revisionContext) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è revision
  const prompt = this.buildRevisionPrompt(input, revisionContext);
  this.emitThinking(context, `–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞—é —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ –∑–∞–º–µ—á–∞–Ω–∏—è–º (–ø–æ–ø—ã—Ç–∫–∞ ${revisionContext.attempt})...`);
} else {
  // –û–±—ã—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
  const prompt = this.buildPrompt(input);
  this.emitThinking(context, `–ü–∏—à—É —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ "${architecture.formatName}"...`);
}
```

#### 5.2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ revision –ø—Ä–æ–º–ø—Ç–∞
**–§–∞–π–ª:** `server/conveyor/agents/writer-agent.ts:141-166`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞:**
```
–£–ª—É—á—à–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ –∑–∞–º–µ—á–∞–Ω–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ó–ê–ú–ï–ß–ê–ù–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
"{revision.notes}"

[–ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã —Å—Ü–µ–Ω—ã]
üéØ –í–´–ë–†–ê–ù–ù–´–ï –°–¶–ï–ù–´ –î–õ–Ø –ü–ï–†–ï–ü–ò–°–´–í–ê–ù–ò–Ø:
–°—Ü–µ–Ω–∞ {sceneId1}: {—Ç–µ–∫—Å—Ç —Å—Ü–µ–Ω—ã}
–°—Ü–µ–Ω–∞ {sceneId2}: {—Ç–µ–∫—Å—Ç —Å—Ü–µ–Ω—ã}
...

[–ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏]
üìö –ò–°–¢–û–†–ò–Ø –ü–†–ï–î–´–î–£–©–ò–• –í–ï–†–°–ò–ô:
--- –í–µ—Ä—Å–∏—è 1 ---
–°—Ü–µ–Ω–∞—Ä–∏–π: {—Ç–µ–∫—Å—Ç}
–ó–∞–º–µ—á–∞–Ω–∏—è: {feedbackText}
...

–§–û–†–ú–ê–¢: {architecture.formatName}

[–ü–∞—Ç—Ç–µ—Ä–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π]
‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–ó–ë–ï–ì–ê–ô (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω—è–ª –∑–∞ —ç—Ç–æ):
- {pattern1}
- {pattern2}

[–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
üß† –ü–ï–†–°–û–ù–ê–õ–ò–ó–ê–¶–ò–Ø (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏):
üéØ –ü–†–ê–í–ò–õ–ê –°–¢–ò–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
‚Ä¢ {rule1}
‚Ä¢ {rule2}
...

–ò–°–•–û–î–ù–´–ô –ú–ê–¢–ï–†–ò–ê–õ:
{source.content}

–ü–µ—Ä–µ–ø–∏—à–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∏—Å–ø—Ä–∞–≤–∏–≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.
–°–æ—Ö—Ä–∞–Ω–∏ —Ö–æ—Ä–æ—à–∏–µ —á–∞—Å—Ç–∏, —É–ª—É—á—à–∏ —Å–ª–∞–±—ã–µ.
–£—á–∏—Ç—ã–≤–∞–π –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π –∏ –∏–∑–±–µ–≥–∞–π –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —Ç–µ—Ö –∂–µ –æ—à–∏–±–æ–∫.
```

#### 5.3. –í—ã–∑–æ–≤ AI
```typescript
const response = await client.messages.create({
  model: "claude-sonnet-4-20250514",
  max_tokens: 3072,
  messages: [{ role: "user", content: prompt }],
});
```

#### 5.4. –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```typescript
const script = this.parseResponse(content.text, architecture);
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
// {
//   scenes: [{ id, label, text, start, end, visualNotes }],
//   fullScript: string,
//   estimatedDuration: number
// }
```

---

### –≠–¢–ê–ü 6: –ü–†–û–•–û–î –ß–ï–†–ï–ó QC ‚Üí OPTIMIZER ‚Üí GATE

**–õ–æ–≥–∏–∫–∞:** –¢–∞ –∂–µ, —á—Ç–æ –∏ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

1. **QC Agent** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
2. **Optimizer Agent** —É–ª—É—á—à–∞–µ—Ç —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
3. **Gate Agent** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ: PASS / FAIL / NEEDS_REVIEW

---

### –≠–¢–ê–ü 7: DELIVERY AGENT –°–û–•–†–ê–ù–Ø–ï–¢ –†–ï–ó–£–õ–¨–¢–ê–¢

**–§–∞–π–ª:** `server/conveyor/agents/delivery-agent.ts`

**–õ–æ–≥–∏–∫–∞:**

#### 7.1. –ï—Å–ª–∏ Gate = PASS –∏–ª–∏ NEEDS_REVIEW
```typescript
// –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π auto_script (–Ω–µ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π!)
await autoScriptsStorage.updateAfterRevision(scriptId, {
  scenes: script.scenes,
  fullScript: script.fullScript,
  initialScore: qc.overallScore,
  finalScore: gate.finalScore,
  hookScore: qc.hookScore,
  structureScore: qc.structureScore,
  emotionalScore: qc.emotionalScore,
  ctaScore: qc.ctaScore,
  gateDecision: gate.decision,
  gateConfidence: String(gate.confidence),
  status: 'pending',  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ pending –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–µ–≤—å—é
  revisionNotes: null,  // –û—á–∏—â–∞–µ–º notes
});
```

#### 7.2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≤ auto_script_versions
```typescript
await autoScriptVersionsStorage.create({
  autoScriptId: scriptId,
  versionNumber: script.revisionCount + 1,
  scenes: script.scenes,
  fullScript: script.fullScript,
  finalScore: gate.finalScore,
  feedbackText: revisionContext.notes,
  feedbackSceneIds: revisionContext.selectedSceneIds,
  isCurrent: true,
});
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ü–µ–Ω–∞—Ä–∏–π –æ–±–Ω–æ–≤–ª—ë–Ω, —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è, —Å—Ç–∞—Ç—É—Å = "pending" (–≥–æ—Ç–æ–≤ –∫ –Ω–æ–≤–æ–º—É —Ä–µ–≤—å—é).

---

## üìä –°–•–ï–ú–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –¢–∞–±–ª–∏—Ü–∞: `auto_scripts`
```sql
id: UUID
userId: UUID
conveyorItemId: UUID  -- –°–≤—è–∑—å —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º conveyor_item
status: 'pending' | 'revision' | 'approved' | 'rejected'
revisionCount: INTEGER  -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Ä–∞–±–æ—Ç–æ–∫ (0-5)
revisionNotes: TEXT     -- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
scenes: JSONB           -- –¢–µ–∫—É—â–∏–µ —Å—Ü–µ–Ω—ã
fullScript: TEXT        -- –¢–µ–∫—É—â–∏–π –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç
```

### –¢–∞–±–ª–∏—Ü–∞: `conveyor_items`
```sql
id: UUID
userId: UUID
sourceType: 'news' | 'instagram'
sourceItemId: UUID
status: 'processing' | 'completed' | 'failed'
parentItemId: UUID      -- –°–≤—è–∑—å —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º item (–¥–ª—è revision)
revisionContext: JSONB  -- { notes, previousScriptId, attempt, previousVersions, selectedSceneIds }
sourceData: JSONB       -- –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ parent
scoringData: JSONB      -- –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ parent
analysisData: JSONB     -- –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ parent
architectureData: JSONB -- –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ parent
scriptData: JSONB       -- –ù–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –æ—Ç Writer
```

### –¢–∞–±–ª–∏—Ü–∞: `auto_script_versions`
```sql
id: UUID
autoScriptId: UUID
versionNumber: INTEGER
scenes: JSONB
fullScript: TEXT
finalScore: INTEGER
feedbackText: TEXT      -- –ó–∞–º–µ—á–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–µ–ª–∏ –∫ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏
feedbackSceneIds: JSONB -- [0, 2] - –∫–∞–∫–∏–µ —Å—Ü–µ–Ω—ã –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–ª–∏—Å—å
isCurrent: BOOLEAN
createdAt: TIMESTAMP
```

---

## üîë –ö–õ–Æ–ß–ï–í–´–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò

### 1. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–ù–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º** scoring, analysis, architecture
- **–ö–æ–ø–∏—Ä—É–µ–º** –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ `conveyor_item`
- **–≠–∫–æ–Ω–æ–º–∏–º** AI –≤—ã–∑–æ–≤—ã –∏ –≤—Ä–µ–º—è

### 2. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π
- Writer –≤–∏–¥–∏—Ç **–≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏** –∏ –∑–∞–º–µ—á–∞–Ω–∏—è –∫ –Ω–∏–º
- –ò–∑–±–µ–≥–∞–µ—Ç **–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ—à–∏–±–æ–∫**
- –£–ª—É—á—à–∞–µ—Ç **–∫–∞—á–µ—Å—Ç–≤–æ —Å –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–µ–π**

### 3. –í—ã–±–æ—Ä–æ—á–Ω–æ–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ü–µ–Ω—ã** –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è
- Writer —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ **–≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ö**
- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω—ã –º–æ–≥—É—Ç –æ—Å—Ç–∞—Ç—å—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 4. Learning System –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ó–∞–º–µ—á–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ **user_feedback_entries**
- AI –∏–∑–≤–ª–µ–∫–∞–µ—Ç **–ø–∞—Ç—Ç–µ—Ä–Ω—ã** –∏–∑ –∑–∞–º–µ—á–∞–Ω–∏–π
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ **—Å–ª–µ–¥—É—é—â–∏—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö**

### 5. –õ–∏–º–∏—Ç –¥–æ—Ä–∞–±–æ—Ç–æ–∫
- –ú–∞–∫—Å–∏–º—É–º **5 –¥–æ—Ä–∞–±–æ—Ç–æ–∫** –Ω–∞ —Å—Ü–µ–Ω–∞—Ä–∏–π
- –ü–æ—Å–ª–µ 5-–π –ø–æ–ø—ã—Ç–∫–∏ ‚Üí **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reject**
- –ó–∞—â–∏—Ç–∞ –æ—Ç **–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤**

---

## ‚ö†Ô∏è –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:
1. UI –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ—Ü–µ–Ω–∑–∏–∏
2. API endpoint `/api/auto-scripts/:id/revise`
3. –ü–æ–º–µ—á–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è –∫–∞–∫ "revision"
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ feedback –≤ Learning System
5. Writer Agent –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `revisionContext`
6. –ü—Ä–æ–º–ø—Ç –¥–ª—è revision —Å —É—á—ë—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏

### ‚ùå –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (TODO):
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ `conveyor_item`** –ø—Ä–∏ revision
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏** revision —á–µ—Ä–µ–∑ –∫–æ–Ω–≤–µ–π–µ—Ä
3. **–°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π** –≤ `auto_script_versions`
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è** –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π revision

### üîß –ß–¢–û –ù–£–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨:

#### 1. –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ revision –≤ `conveyor-runner.ts`
```typescript
async function processRevisionRequests() {
  // –ù–∞–π—Ç–∏ –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ "revision"
  const revisionScripts = await autoScriptsStorage.getByStatus('revision');
  
  for (const script of revisionScripts) {
    // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π conveyor_item —Å revisionContext
    // –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ orchestrator
  }
}
```

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `conveyor-orchestrator.ts`
```typescript
async processItem(userId, sourceData, apiKey, revisionContext?) {
  // –ï—Å–ª–∏ revisionContext –µ—Å—Ç—å ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø—ã 1-4
  // –ù–∞—á–∞—Ç—å —Å —ç—Ç–∞–ø–∞ 5 (Writer)
}
```

#### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `delivery-agent.ts`
```typescript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π revision:
// - –û–±–Ω–æ–≤–∏—Ç—å auto_script
// - –°–æ–∑–¥–∞—Ç—å auto_script_version
// - –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç—É—Å –≤ "pending"
```

---

## üìù –ü–†–ò–ú–ï–† FLOW

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Üí "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É"
2. **UI:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /api/auto-scripts/:id/revise` —Å `feedbackText` –∏ `selectedSceneIds`
3. **API:** –ü–æ–º–µ—á–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∫–∞–∫ "revision", —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç feedback
4. **TODO:** –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π `conveyor_item` —Å `revisionContext`
5. **TODO:** –ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ –∫–æ–Ω–≤–µ–π–µ—Ä (—Å —ç—Ç–∞–ø–∞ Writer)
6. **Writer:** –ü–æ–ª—É—á–∞–µ—Ç `revisionContext` ‚Üí —Å—Ç—Ä–æ–∏—Ç –ø—Ä–æ–º–ø—Ç —Å —É—á—ë—Ç–æ–º –∑–∞–º–µ—á–∞–Ω–∏–π
7. **AI:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ –ø—Ä–æ–º–ø—Ç—É
8. **QC ‚Üí Optimizer ‚Üí Gate:** –ü—Ä–æ–≤–µ—Ä—è—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ
9. **Delivery:** –û–±–Ω–æ–≤–ª—è–µ—Ç `auto_script`, —Å–æ–∑–¥–∞—ë—Ç `auto_script_version`
10. **UI:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ —Å—Ç–∞—Ç—É—Å–µ "pending"

---

## üéØ –ò–¢–û–ì

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –†–µ–≤–∏–∑–∏—è **–ø–æ–º–µ—á–∞–µ—Ç—Å—è**, –Ω–æ **–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**.

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é
- ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ "revision"
- ‚úÖ Feedback —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Learning System
- ‚úÖ Writer Agent –≥–æ—Ç–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å revision

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ `conveyor_item` –¥–ª—è revision
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É revision —á–µ—Ä–µ–∑ cron job –∏–ª–∏ —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å.

---

## üí° –ü–†–û–°–¢–û–ï –û–ë–™–Ø–°–ù–ï–ù–ò–ï

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É?

**1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —Ä–µ—Ü–µ–Ω–∑–∏—é:**
```
"–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ, —É–±–µ—Ä–∏ –∫–ª–∏—à–µ —Ç–∏–ø–∞ '–°–¢–û–ü!', –¥–æ–±–∞–≤—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã"
```

**2. –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–º–µ—á–∞–Ω–∏—è:**
- –ü–æ–º–µ—á–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∫–∞–∫ "revision"
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç —Ä–µ—Ü–µ–Ω–∑–∏–∏
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –¥–æ—Ä–∞–±–æ—Ç–æ–∫ (1, 2, 3...)

**3. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É –Ω–∞ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ:**
- –ë–µ—Ä—ë—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
- –ë–µ—Ä—ë—Ç –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ (–µ—Å–ª–∏ –±—ã–ª–∏)
- –°–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É –¥–ª—è AI: "–ü–µ—Ä–µ–ø–∏—à–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ —ç—Ç–∏–º –∑–∞–º–µ—á–∞–Ω–∏—è–º"

**4. AI –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π:**
- –ß–∏—Ç–∞–µ—Ç –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–º–æ—Ç—Ä–∏—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ (—á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ—à–∏–±–∫–∏)
- –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

**5. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ:**
- QC –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: —Ö–æ—Ä–æ—à–∏–π –ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π?
- Optimizer —É–ª—É—á—à–∞–µ—Ç —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞
- Gate —Ä–µ—à–∞–µ—Ç: –æ–¥–æ–±—Ä–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å?

**6. –†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏
- –°—Ü–µ–Ω–∞—Ä–∏–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å "pending" –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–µ–≤—å—é

### –ü–æ—á–µ–º—É —ç—Ç–æ —É–º–Ω–æ?

‚úÖ **–ù–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å—ë –∑–∞–Ω–æ–≤–æ** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ –≥–æ—Ç–æ–≤—ã–µ –∞–Ω–∞–ª–∏–∑ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É  
‚úÖ **–£—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é** ‚Äî –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π  
‚úÖ **–£—á–∏—Ç—Å—è –Ω–∞ –∑–∞–º–µ—á–∞–Ω–∏—è—Ö** ‚Äî –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç, —á—Ç–æ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é  
‚úÖ **–§–æ–∫—É—Å –Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞—Ö** ‚Äî –º–æ–∂–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã  
‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤** ‚Äî –º–∞–∫—Å–∏–º—É–º 5 –¥–æ—Ä–∞–±–æ—Ç–æ–∫, –ø–æ—Ç–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reject

---

## üîç –î–ï–¢–ê–õ–ò –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

#### RevisionContext
```typescript
{
  notes: "–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ, —É–±–µ—Ä–∏ –∫–ª–∏—à–µ",
  previousScriptId: "uuid-–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ-—Å—Ü–µ–Ω–∞—Ä–∏—è",
  attempt: 2,  // –ö–∞–∫–∞—è —ç—Ç–æ –ø–æ–ø—ã—Ç–∫–∞ (1, 2, 3...)
  previousVersions: [
    {
      versionNumber: 1,
      fullScript: "–¢–µ–∫—Å—Ç –ø–µ—Ä–≤–æ–π –≤–µ—Ä—Å–∏–∏...",
      feedbackText: "–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π"
    }
  ],
  selectedSceneIds: [0, 2]  // –ö–∞–∫–∏–µ —Å—Ü–µ–Ω—ã –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å
}
```

#### EnhancedRevisionContext
–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π
- –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω—ã –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ Learning System

### –ü—Ä–æ–º–ø—Ç –¥–ª—è Writer –ø—Ä–∏ revision

**–û–±—ã—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–Ω–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π):**
```
–ü–∏—à–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Hot Take"...
–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ —Ñ–∞–∫—Ç—ã: [...]
–°—Ç—Ä—É–∫—Ç—É—Ä–∞: hook ‚Üí context ‚Üí main ‚Üí twist ‚Üí cta
```

**Revision –ø—Ä–æ–º–ø—Ç (–¥–æ—Ä–∞–±–æ—Ç–∫–∞):**
```
–£–ª—É—á—à–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ –∑–∞–º–µ—á–∞–Ω–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ó–ê–ú–ï–ß–ê–ù–ò–Ø:
"–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ, —É–±–µ—Ä–∏ –∫–ª–∏—à–µ —Ç–∏–ø–∞ '–°–¢–û–ü!'"

–ò–°–¢–û–†–ò–Ø –ü–†–ï–î–´–î–£–©–ò–• –í–ï–†–°–ò–ô:
--- –í–µ—Ä—Å–∏—è 1 ---
–°—Ü–µ–Ω–∞—Ä–∏–π: [—Ç–µ–∫—Å—Ç]
–ó–∞–º–µ—á–∞–Ω–∏—è: "–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π"

‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–ó–ë–ï–ì–ê–ô:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∏—à–µ "–°–¢–û–ü!"
- –î–µ–ª–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª–∏–Ω–Ω–µ–µ 60 —Å–µ–∫—É–Ω–¥

–ü–µ—Ä–µ–ø–∏—à–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π, –∏—Å–ø—Ä–∞–≤–∏–≤ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.
–£—á–∏—Ç—ã–≤–∞–π –∏—Å—Ç–æ—Ä–∏—é –∏ –∏–∑–±–µ–≥–∞–π –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ—à–∏–±–æ–∫.
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã Learning System

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π:**
```
–ü—Ä–∏—á–∏–Ω–∞: "–°–ª–∏—à–∫–æ–º —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π"
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: TOO_FORMAL
```

**Learning System:**
1. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω: `{ TOO_FORMAL: { count: 1, instruction: "–ü–∏—à–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–º —è–∑—ã–∫–æ–º" } }`
2. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º revision –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –ø—Ä–æ–º–ø—Ç:
   ```
   ‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–ó–ë–ï–ì–ê–ô:
   - –ü–∏—à–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–º —è–∑—ã–∫–æ–º (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω—è–ª –∑–∞ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç—å)
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–±–µ–≥–∞–µ—Ç —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.

---

## üìà –ú–ï–¢–†–ò–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è:

1. **revisionCount** ‚Äî —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è —Å—Ü–µ–Ω–∞—Ä–∏–π (0-5)
2. **revisionNotes** ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **auto_script_versions** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π
4. **user_feedback_entries** ‚Äî –≤—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:

```sql
-- auto_scripts
id: abc-123
revisionCount: 2
status: 'revision'
revisionNotes: '–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ, –¥–æ–±–∞–≤—å —é–º–æ—Ä'

-- auto_script_versions
version 1: fullScript = "–ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è..."
version 2: fullScript = "–í—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è...", feedbackText = "–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π"
version 3: fullScript = "–¢—Ä–µ—Ç—å—è –≤–µ—Ä—Å–∏—è...", feedbackText = "–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ, –¥–æ–±–∞–≤—å —é–º–æ—Ä"

-- user_feedback_entries
entry 1: feedbackType = 'revision', feedbackText = "–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π"
entry 2: feedbackType = 'revision', feedbackText = "–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ, –¥–æ–±–∞–≤—å —é–º–æ—Ä"
```

---

## üéØ –ò–¢–û–ì–û–í–ê–Ø –°–•–ï–ú–ê –î–ê–ù–ù–´–•

```
auto_scripts (–æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π)
    ‚îÇ
    ‚îú‚îÄ‚îÄ revisionCount: 2
    ‚îú‚îÄ‚îÄ status: 'revision'
    ‚îú‚îÄ‚îÄ revisionNotes: "–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—á–µ..."
    ‚îÇ
    ‚îú‚îÄ‚îÄ conveyorItemId ‚Üí conveyor_items (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π)
    ‚îÇ                      ‚îÇ
    ‚îÇ                      ‚îî‚îÄ‚îÄ parentItemId ‚Üí conveyor_items (–Ω–æ–≤—ã–π –¥–ª—è revision)
    ‚îÇ                                           ‚îÇ
    ‚îÇ                                           ‚îî‚îÄ‚îÄ revisionContext: {...}
    ‚îÇ
    ‚îî‚îÄ‚îÄ auto_script_versions (–∏—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π)
         ‚îú‚îÄ‚îÄ version 1: fullScript = "..."
         ‚îú‚îÄ‚îÄ version 2: fullScript = "...", feedbackText = "..."
         ‚îî‚îÄ‚îÄ version 3: fullScript = "...", feedbackText = "..."
```

---

**–î–æ–∫—É–º–µ–Ω—Ç –≥–æ—Ç–æ–≤!** üìö

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Ä–µ–≤–∏–∑–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

