‚úÖ –û–¢–õ–ò–ß–ù–û! –ù–û –ü–û–ì–û–î–ò...
üéØ –ß–¢–û AGENT –°–î–ï–õ–ê–õ:
‚úÖ getUserId() utility
‚úÖ Project ownership checks
‚úÖ Idempotency for B-roll (generateIdempotencyKey)
‚úÖ HeyGen validation (audioUrl XOR voiceId)
‚úÖ Error handling improvements
‚úÖ storage.getProjectById() method
‚úÖ idempotency-utils.ts module
```

**–≠—Ç–æ –≤—Å—ë SECURITY & RELIABILITY —Ñ–∏–∫—Å—ã!** üîí

---

## üî¥ –ù–û –ì–î–ï VIDEO DOWNLOAD?!

### **–ì–ª–∞–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª:**
```
‚ùå NO downloadInstagramVideo()
‚ùå NO local mp4 storage
‚ùå NO /uploads/instagram-reels/
‚ùå NO ffprobe metadata
‚ùå NO fetchSingleReelData() for URL refresh
–≠—Ç–æ –±—ã–ª–∞ Phase 3.5 –∏–∑ –Ω–∞—à–µ–≥–æ –ø–ª–∞–Ω–∞!

üìã –ß–¢–û –ú–´ –û–ë–°–£–ñ–î–ê–õ–ò –†–ê–ù–¨–®–ï:
–ò–∑ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ö–†–ò–¢–ò–ß–ù–û:
typescript// –°–¢–ê–†–´–ô –ü–†–û–ï–ö–¢ –ò–ú–ï–õ:

1. downloadAndStore(videoUrl, reelId)
   - –°–∫–∞—á–∏–≤–∞–ª mp4 –ª–æ–∫–∞–ª—å–Ω–æ
   - –°–æ—Ö—Ä–∞–Ω—è–ª –≤ /uploads/viral-reels/
   - –ò–∑–≤–ª–µ–∫–∞–ª metadata —á–µ—Ä–µ–∑ ffprobe
   
2. fetchSingleReelData(shortCode)
   - Refresh expired URLs
   - –ù—É–∂–Ω–æ –¥–ª—è transcription
   
3. Video metadata extraction
   - duration, fps, size, width, height
```

---

## ü§î ANALYSIS GAP:

**GPT –¥–∞–ª —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ:**
- Security (ownership checks) ‚úÖ
- Reliability (idempotency) ‚úÖ
- Error handling ‚úÖ

**–ù–û –ù–ï –£–ü–û–ú–Ø–ù–£–õ:**
- Video download (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
- Transcription pipeline
- Metadata extraction
- URL refresh mechanism

**–ü–æ—á–µ–º—É?**

–í–æ–∑–º–æ–∂–Ω–æ GPT –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª —Ç–æ–ª—å–∫–æ **routes.ts**, –Ω–æ –Ω–µ –≤–∏–¥–µ–ª:
- apify-service.ts (–≥–¥–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å download)
- storage.ts (–≥–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å video paths)
- –ü–æ–ª–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Phase 3.5

---

## ‚ö° –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï:

### **Option 1: –°–ø—Ä–æ—Å–∏—Ç—å Agent –Ω–∞–ø—Ä—è–º—É—é**
```
Agent, great work on security fixes!

But I have a critical question:
Does the system download Instagram videos LOCALLY?

Check:
1. Is there downloadInstagramVideo() function?
2. Are videos saved to /uploads/instagram-reels/?
3. Is localVideoPath stored in database?
4. Is ffprobe used for metadata?

This is CRITICAL for Phase 5 (Transcription)!
Instagram URLs expire in 24-48 hours!

If NOT implemented - we need Phase 3.5!

Option 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∞–º
–û—Ç–∫—Ä–æ–π Database ‚Üí instagram_items table:
sqlSELECT 
  id,
  external_id,
  video_url,
  local_video_path,  -- ‚Üê –ï—Å—Ç—å –ª–∏ —ç—Ç–æ –ø–æ–ª–µ?
  download_status     -- ‚Üê –ï—Å—Ç—å –ª–∏ —ç—Ç–æ –ø–æ–ª–µ?
FROM instagram_items
LIMIT 1;
```

**–ï—Å–ª–∏ –∫–æ–ª–æ–Ω–æ–∫ –ù–ï–¢ ‚Üí Video download –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω!**

---

### **Option 3: –ü–æ—Å–º–æ—Ç—Ä–∏ —Ñ–∞–π–ª—ã**

**–ü—Ä–æ–≤–µ—Ä—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ:**
```
1. server/apify-service.ts
   - –ï—Å—Ç—å –ª–∏ downloadInstagramVideo()?
   
2. /uploads/instagram-reels/
   - –ï—Å—Ç—å –ª–∏ —ç—Ç–∞ –ø–∞–ø–∫–∞?
   - –ï—Å—Ç—å –ª–∏ –≤ –Ω–µ–π .mp4 —Ñ–∞–π–ª—ã?
   
3. shared/schema.ts
   - –ï—Å—Ç—å –ª–∏ localVideoPath –ø–æ–ª–µ?
   - –ï—Å—Ç—å –ª–∏ downloadStatus –ø–æ–ª–µ?
```

---

## üìä –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°:
```
Phase 1: API Keys ‚úÖ
Phase 2: Apify Scraping ‚úÖ
Phase 3: Instagram Items Storage ‚úÖ
Phase 3.5: Video Download ‚ùå (MISSING!)
Phase 4: Content Selection UI ‚úÖ
Phase 5: Transcription ‚è∏Ô∏è (BLOCKED by 3.5!)
```

---

## üí¨ –ú–û–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:

**–°–ö–ê–ñ–ò AGENT:**
```
Agent, excellent security improvements! 

But critical question:
Are Instagram videos downloaded LOCALLY?

We discussed Phase 3.5 earlier:
- Download mp4 files to /uploads/instagram-reels/
- Store localVideoPath in database
- Extract metadata with ffprobe
- Add downloadStatus tracking

This is CRITICAL because:
1. Instagram URLs expire in 24-48 hours
2. Transcription needs local files
3. Without local storage - system breaks at Phase 5

Please check:
1. Does downloadInstagramVideo() exist?
2. Is localVideoPath field in instagram_items table?
3. Are videos saved locally?

If NO - please implement Phase 3.5 now!
This blocks transcription!

üéØ –ò–¢–û–ì:
Agent —Å–¥–µ–ª–∞–ª –æ—Ç–ª–∏—á–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–æ:

‚úÖ Security
‚úÖ Reliability
‚úÖ Error handling

–ù–û –ü–†–û–ü–£–°–¢–ò–õ:

‚ùå Video download (–∫—Ä–∏—Ç–∏—á–Ω–æ!)

Phase 3.5 –≤—Å—ë –µ—â—ë –Ω—É–∂–Ω–∞!