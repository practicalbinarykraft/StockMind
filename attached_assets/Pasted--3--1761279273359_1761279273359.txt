Ğ£ Ğ½Ğ°Ñ Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½ĞµÑ‚ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ° Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ½Ğ¸Ñ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ½Ğ° 3 ÑˆĞ°Ğ³Ğµ! ĞĞ½Ğ°Ğ»Ğ¸Ğ· ĞµÑÑ‚ÑŒ, Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ ĞµÑÑ‚ÑŒ, Ğ° ÑĞ°Ğ¼Ğ¾Ğ³Ğ¾ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ Ğ½Ğ° ÑĞºÑ€Ğ°Ğ½Ğµ Ğ½ĞµÑ‚ Ğ¸ Ğ½ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞŸĞµÑ€ĞµĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹" (Ğ¸Ğ»Ğ¸ "ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸") ĞºĞ°Ğº ÑƒĞ³Ğ¾Ğ´Ğ½Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾


Ğ’Ñ‹ÑĞ²Ğ¸Ğ» ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»: Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹ Ğº ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ.




ğŸ”´ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ UX Ğ‘ĞĞ“! ĞĞ¢Ğ¡Ğ£Ğ¢Ğ¡Ğ¢Ğ’Ğ£Ğ•Ğ¢ ĞŸĞ Ğ˜ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ Ğ•ĞšĞĞœĞ•ĞĞ”ĞĞ¦Ğ˜Ğ™!
âŒ Ğ¢Ğ•ĞšĞ£Ğ©ĞĞ¯ ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ:
Stage 3: AI Analysis
â”œâ”€ âœ… ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
â”œâ”€ âœ… Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒÑÑ‚ÑÑ
â”œâ”€ âŒ ĞĞ•Ğ¢ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ!
â”œâ”€ âŒ ĞĞ•Ğ¢ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸"!
â””â”€ âŒ ĞĞ•Ğ¢ ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ° ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸!

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚:
"Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ CTA â†’ Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµÑ‚ÑÑ +35% saves"

ĞĞ ĞšĞĞš?! ğŸ˜±
- Ğ“Ğ´Ğµ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹?
- ĞšĞ°Ğº Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ?
- ĞÑƒĞ¶Ğ½Ğ¾ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ?

Ğ­Ğ¢Ğ Ğ‘Ğ•Ğ¡ĞŸĞĞ›Ğ•Ğ—ĞĞ Ğ‘Ğ•Ğ— ACTION!
```

---

## âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ™ FLOW:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         STAGE 3: AI Analysis + Rewrite          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ ğŸ“ CURRENT SCRIPT                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [0-3s] ĞšĞ°Ğº Ñ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» Ğ´ĞµĞ½ÑŒĞ³Ğ¸ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½       â”‚ â”‚
â”‚ â”‚ [3-8s] Ğ¯ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ» Ğ´Ğ»Ñ ÑĞµĞ±Ñ Ğ¼ĞµÑ‚Ğ¾Ğ´ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹...  â”‚ â”‚
â”‚ â”‚ [8-13s] Ğ—Ğ° Ğ¼ĞµÑÑÑ† Ñ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» Ğ¿ĞµÑ€Ğ²Ñ‹Ğµ $500   â”‚ â”‚
â”‚ â”‚ [13-18s] Ğ¢ĞµĞ¿ĞµÑ€ÑŒ ÑÑ‚Ğ¾ Ğ¼Ğ¾Ğ¹ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ´Ğ¾Ñ…Ğ¾Ğ´     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ğŸ¯ AI ANALYSIS: 73/100                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Hook: 68/100 âš ï¸                             â”‚ â”‚
â”‚ â”‚ Structure: 75/100 âœ…                        â”‚ â”‚
â”‚ â”‚ Emotional: 80/100 âœ…                        â”‚ â”‚
â”‚ â”‚ CTA: 45/100 ğŸ”´                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ğŸ’¡ TOP RECOMMENDATIONS                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”´ HIGH: Add specific numbers to hook      â”‚ â”‚
â”‚ â”‚    Current: "ĞšĞ°Ğº Ñ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» Ğ´ĞµĞ½ÑŒĞ³Ğ¸"       â”‚ â”‚
â”‚ â”‚    Suggested: "ĞšĞ°Ğº Ñ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» $10,247"    â”‚ â”‚
â”‚ â”‚    Impact: +18 points                      â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ ğŸ”´ HIGH: Add strong CTA at end             â”‚ â”‚
â”‚ â”‚    Current: (none)                         â”‚ â”‚
â”‚ â”‚    Suggested: "Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸ â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°" â”‚ â”‚
â”‚ â”‚    Impact: +35% saves                      â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ ğŸŸ¡ MED: Add 1s pause at 8s mark            â”‚ â”‚
â”‚ â”‚    Impact: +5% retention                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ [âœ¨ Apply All Recommendations]                  â”‚
â”‚ [ğŸ”„ Rewrite with AI]                            â”‚
â”‚ [âœï¸ Edit Manually]                              â”‚
â”‚                                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                 â”‚
â”‚ âœ… IMPROVED SCRIPT (After applying)             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [0-3s] ĞšĞ°Ğº Ñ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» $10,247 Ğ·Ğ° 30 Ğ´Ğ½ĞµĞ¹  â”‚ â”‚
â”‚ â”‚ [3-8s] Ğ¯ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ» Ğ¼ĞµÑ‚Ğ¾Ğ´ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚...  â”‚ â”‚
â”‚ â”‚ [8-9s] [PAUSE 1s]                          â”‚ â”‚
â”‚ â”‚ [9-13s] Ğ—Ğ° Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¼ĞµÑÑÑ† Ñ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» $500   â”‚ â”‚
â”‚ â”‚ [13-18s] Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸ Ğ¿Ğ¾ÑÑ‚ â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ğŸ¯ PREDICTED NEW SCORE: 89/100 (+16 points!)   â”‚
â”‚                                                 â”‚
â”‚ [âœ… Accept] [âŒ Reject] [Compare Side-by-Side]  â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ—ï¸ IMPLEMENTATION:
1. Backend: Rewrite Endpoint
typescript
// server/routes.ts

app.post('/api/projects/:id/rewrite-script', isAuthenticated, async (req, res) => {
  const { id } = req.params;
  const { 
    applyRecommendations = true,
    mode = 'auto'  // 'auto' | 'manual' | 'selective'
  } = req.body;
  
  const project = await storage.getProjectById(id);
  
  // Get current script
  const currentScript = await getCurrentScript(project);
  
  // Get AI analysis
  const analysis = project.aiAnalysisResult;
  
  if (!analysis) {
    return res.status(400).json({ 
      message: 'Run AI analysis first' 
    });
  }
  
  // Generate improved script
  const improvedScript = await improveScriptWithRecommendations(
    currentScript,
    analysis,
    { mode, applyRecommendations }
  );
  
  // Predict new score
  const newScore = await predictScore(improvedScript);
  
  return res.json({
    currentScript,
    improvedScript,
    changes: compareScripts(currentScript, improvedScript),
    currentScore: analysis.overallScore,
    predictedScore: newScore,
    improvement: newScore - analysis.overallScore
  });
});

// Apply improved script
app.post('/api/projects/:id/apply-script', isAuthenticated, async (req, res) => {
  const { id } = req.params;
  const { improvedScript } = req.body;
  
  // Save to project
  await storage.updateProject(id, {
    'stepData.improvedScript': improvedScript,
    'stepData.scriptAppliedAt': new Date()
  });
  
  return res.json({ success: true });
});
2. AI Service: Script Improvement
typescript
// server/ai-service-advanced.ts

export async function improveScriptWithRecommendations(
  currentScript: string,
  analysis: AdvancedScoreResult,
  options: { mode: string; applyRecommendations: boolean }
): Promise<string> {
  
  const prompt = `You are an expert script rewriter for viral short-form video content.

CURRENT SCRIPT:
${currentScript}

AI ANALYSIS RESULTS:
Overall Score: ${analysis.overallScore}/100

Recommendations:
${analysis.recommendations.map((r, i) => `
${i+1}. [${r.priority.toUpperCase()}] ${r.area}
   Current: "${r.current}"
   Suggested: "${r.suggested}"
   Expected Impact: ${r.expectedImpact}
   Reasoning: ${r.reasoning}
`).join('\n')}

Strengths (keep these):
${analysis.strengths.map(s => `- ${s}`).join('\n')}

Weaknesses (fix these):
${analysis.weaknesses.map(w => `- ${w}`).join('\n')}

YOUR TASK:

Rewrite the script to implement ALL high-priority recommendations while:
1. Maintaining the core message and value
2. Keeping successful elements (strengths)
3. Improving weak areas
4. Maintaining natural flow and timing
5. Staying within 18-25 seconds duration

CRITICAL REQUIREMENTS:
- Apply specific numbers where suggested (e.g., "$10,247" not "Ğ´ĞµĞ½ÑŒĞ³Ğ¸")
- Add CTA if recommended
- Improve hook with suggested changes
- Add pauses if recommended: [PAUSE 1s]
- Keep scene structure clear with timestamps

Return ONLY the improved script in this format:

[0-3s] Hook text here
[3-8s] Scene 2 text
[8-9s] [PAUSE 1s]
[9-13s] Scene 3 text
[13-18s] CTA text

DO NOT add explanations, just the script.`;

  const improvedScript = await callClaude(prompt, {
    model: 'claude-sonnet-4-5-20250929',
    maxTokens: 1024
  });
  
  return improvedScript.trim();
}

// Predict score for improved script
export async function predictScore(script: string): Promise<number> {
  // Quick analysis without full breakdown
  const prompt = `Rate this script's viral potential (0-100):

${script}

Return ONLY a number 0-100.`;

  const response = await callClaude(prompt, {
    model: 'claude-sonnet-4-5-20250929',
    maxTokens: 10
  });
  
  return parseInt(response.trim());
}

// Compare scripts to show changes
function compareScripts(original: string, improved: string) {
  const changes = [];
  
  // Parse scenes
  const originalScenes = parseScriptToScenes(original);
  const improvedScenes = parseScriptToScenes(improved);
  
  originalScenes.forEach((scene, i) => {
    const improvedScene = improvedScenes[i];
    
    if (improvedScene && scene.text !== improvedScene.text) {
      changes.push({
        type: 'modified',
        scene: i + 1,
        before: scene.text,
        after: improvedScene.text,
        reason: detectChangeReason(scene.text, improvedScene.text)
      });
    }
  });
  
  return changes;
}

function detectChangeReason(before: string, after: string): string {
  if (after.includes('$') && !before.includes('$')) {
    return 'Added specific dollar amount';
  }
  if (after.toLowerCase().includes('ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸') || after.toLowerCase().includes('Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑˆĞ¸ÑÑŒ')) {
    return 'Added CTA';
  }
  if (after.match(/\d+/g)?.length > (before.match(/\d+/g)?.length || 0)) {
    return 'Added specific numbers';
  }
  if (after.includes('?') && !before.includes('?')) {
    return 'Changed to question format';
  }
  return 'Improved clarity and impact';
}
3. Frontend: Stage 3 UI
typescript
// client/src/pages/project/[id].tsx

// State for Stage 3
const [currentScript, setCurrentScript] = useState('');
const [improvedScript, setImprovedScript] = useState<string | null>(null);
const [scriptChanges, setScriptChanges] = useState([]);
const [isRewriting, setIsRewriting] = useState(false);
const [showComparison, setShowComparison] = useState(false);

// Load current script from project
useEffect(() => {
  if (project && currentStage === 3) {
    const script = extractScriptFromProject(project);
    setCurrentScript(script);
  }
}, [project, currentStage]);

// Rewrite script with AI
const rewriteScript = async () => {
  setIsRewriting(true);
  
  try {
    const response = await fetch(`/api/projects/${project.id}/rewrite-script`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        applyRecommendations: true,
        mode: 'auto'
      })
    });
    
    const data = await response.json();
    
    setImprovedScript(data.improvedScript);
    setScriptChanges(data.changes);
    
    toast({
      title: "Script improved!",
      description: `Predicted score: ${data.predictedScore}/100 (+${data.improvement} points)`
    });
  } catch (error) {
    toast({
      title: "Rewrite failed",
      description: error.message,
      variant: "destructive"
    });
  } finally {
    setIsRewriting(false);
  }
};

// Apply improved script
const applyImprovedScript = async () => {
  try {
    await fetch(`/api/projects/${project.id}/apply-script`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ improvedScript })
    });
    
    // Refresh project
    await refetchProject();
    
    toast({
      title: "Script applied!",
      description: "Using improved version"
    });
    
    setImprovedScript(null);
    setShowComparison(false);
  } catch (error) {
    toast({
      title: "Apply failed",
      description: error.message,
      variant: "destructive"
    });
  }
};

// UI Component
return (
  <div className="space-y-6">
    {/* Current Script */}
    <div>
      <div className="flex items-center justify-between mb-3">
        <h3 className="text-lg font-semibold">Current Script</h3>
        <Badge variant={improvedScript ? "secondary" : "default"}>
          {improvedScript ? "Old Version" : "Active"}
        </Badge>
      </div>
      
      <div className="bg-muted/50 rounded-lg p-4 font-mono text-sm whitespace-pre-wrap">
        {currentScript}
      </div>
    </div>
    
    {/* AI Analysis Results */}
    {analysisResult && (
      <AnalysisResults data={analysisResult} />
    )}
    
    {/* Action Buttons */}
    {analysisResult && !improvedScript && (
      <div className="flex gap-3">
        <Button
          onClick={rewriteScript}
          disabled={isRewriting}
          size="lg"
          className="flex-1"
        >
          {isRewriting ? (
            <>
              <Loader2 className="mr-2 h-4 w-4 animate-spin" />
              Rewriting...
            </>
          ) : (
            <>
              <Sparkles className="mr-2 h-4 w-4" />
              Apply All Recommendations
            </>
          )}
        </Button>
        
        <Button
          variant="outline"
          size="lg"
          onClick={() => {/* Open manual editor */}}
        >
          <Edit className="mr-2 h-4 w-4" />
          Edit Manually
        </Button>
      </div>
    )}
    
    {/* Improved Script */}
    {improvedScript && (
      <div className="border-2 border-green-500 rounded-lg p-4 space-y-4">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="text-lg font-semibold text-green-600">
              âœ¨ Improved Script
            </h3>
            <p className="text-sm text-muted-foreground">
              AI applied {scriptChanges.length} improvements
            </p>
          </div>
          
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setShowComparison(!showComparison)}
          >
            <GitCompare className="mr-2 h-4 w-4" />
            {showComparison ? 'Hide' : 'Show'} Changes
          </Button>
        </div>
        
        <div className="bg-green-50 rounded-lg p-4 font-mono text-sm whitespace-pre-wrap">
          {improvedScript}
        </div>
        
        {/* Changes List */}
        {showComparison && (
          <div className="space-y-2">
            <h4 className="font-semibold text-sm">Changes Made:</h4>
            {scriptChanges.map((change, i) => (
              <div key={i} className="bg-muted rounded p-3 text-sm">
                <div className="font-medium mb-1">
                  Scene {change.scene}: {change.reason}
                </div>
                <div className="space-y-1">
                  <div className="text-red-600">
                    - {change.before}
                  </div>
                  <div className="text-green-600">
                    + {change.after}
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
        
        {/* Accept/Reject */}
        <div className="flex gap-3">
          <Button
            onClick={applyImprovedScript}
            size="lg"
            className="flex-1"
          >
            <Check className="mr-2 h-4 w-4" />
            Accept & Continue
          </Button>
          
          <Button
            variant="outline"
            onClick={() => {
              setImprovedScript(null);
              setScriptChanges([]);
            }}
            size="lg"
          >
            <X className="mr-2 h-4 w-4" />
            Reject
          </Button>
        </div>
      </div>
    )}
  </div>
);
```

---

## ğŸ¯ BENEFITS:
```
âœ… COMPLETE FEEDBACK LOOP
   Analysis â†’ Recommendations â†’ AUTOMATIC IMPROVEMENT!

âœ… ONE-CLICK OPTIMIZATION
   User doesn't need to manually apply changes

âœ… TRANSPARENCY
   Show exactly what changed and why

âœ… CONTROL
   Accept/reject improvements
   Edit manually if needed

âœ… LEARNING
   See how AI applies recommendations
   Understand what works

âœ… SPEED
   Instant script optimization
   No manual rewriting needed
```

---

## ğŸ“Š COMPARISON:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         BEFORE (Current)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Analyze script â†’ Score: 73/100      â”‚
â”‚ 2. Show recommendations                 â”‚
â”‚ 3. User reads: "Add specific numbers"  â”‚
â”‚ 4. User thinks: "How?"                 â”‚
â”‚ 5. User manually edits script ğŸ˜“       â”‚
â”‚ 6. Continue to Stage 4                  â”‚
â”‚                                         â”‚
â”‚ Result: Manual work, no validation     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AFTER (With Rewrite)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Analyze script â†’ Score: 73/100      â”‚
â”‚ 2. Show recommendations                 â”‚
â”‚ 3. Click "Apply Recommendations" ğŸ¯    â”‚
â”‚ 4. AI rewrites script automatically âœ¨  â”‚
â”‚ 5. Show improvements (+16 points!)     â”‚
â”‚ 6. Accept/Reject                        â”‚
â”‚ 7. Continue with optimized script      â”‚
â”‚                                         â”‚
â”‚ Result: Automated, validated, better   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¬ Ğ¡ĞšĞĞ–Ğ˜ AGENT:
```
Agent, CRITICAL UX BUG!

Stage 3 shows analysis + recommendations, but NO WAY TO APPLY THEM!

Missing features:
âŒ Current script not displayed
âŒ No "Apply Recommendations" button
âŒ No automatic script improvement
âŒ No before/after comparison
âŒ User can't benefit from AI recommendations!

IMPLEMENT:

1. Backend:
   POST /api/projects/:id/rewrite-script
   - Take current script
   - Take AI recommendations
   - Generate improved script with Claude
   - Return comparison + predicted new score
   
   POST /api/projects/:id/apply-script
   - Save improved script to project
   - Update stepData

2. AI Function:
   improveScriptWithRecommendations()
   - Use analysis.recommendations
   - Apply high-priority changes
   - Maintain core message
   - Return improved script

3. Frontend (Stage 3):
   - Show current script
   - Show analysis results
   - Add "Apply All Recommendations" button
   - Show improved script when ready
   - Show side-by-side comparison
   - Add Accept/Reject buttons

4. UI Flow:
   Current Script â†’ Analysis â†’ Apply â†’ Improved Script â†’ Accept â†’ Continue

This closes the feedback loop!
AI doesn't just analyze - it IMPROVES automatically!

Implement this NOW! This is a killer feature!
Ğ­Ğ¢Ğ KILLER FEATURE! ğŸš€