Ñ Ğ²ÑĞ¿Ğ¾Ğ¼Ğ½Ğ¸Ğ» Ğ¿Ñ€Ğ¾ Ñ„Ğ¸Ñ‡Ñƒ. Ğ½Ğ° ÑÑ‚Ğ°Ğ¿Ğµ Ğ¾Ğ·Ğ²ÑƒÑ‡ĞºĞ¸ Ñƒ Ğ½Ğ°Ñ Ğ¶Ğµ Ğ±Ñ‹Ğ» Ğ²Ğ°Ñ€Ğ¸Ğº Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ÑĞ²Ñ‘ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ´Ğ°? Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ğ´Ğ°Ğ»ÑŒÑˆĞµ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ˜Ğ˜ Ğ°Ğ²Ğ°Ñ‚Ğ°Ñ€Ğ°

ğŸ¯ Ğ”Ğ! Ğ¢ĞĞ§ĞĞ! Ğ’ĞĞ–ĞĞĞ¯ Ğ¤Ğ˜Ğ§Ğ!
ğŸ¤ STAGE 4: Ğ”Ğ’Ğ Ğ Ğ•Ğ–Ğ˜ĞœĞ ĞĞ—Ğ’Ğ£Ğ§ĞšĞ˜
Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ: AI Voice Generation (ElevenLabs)
1. Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ³Ğ¾Ğ»Ğ¾Ñ (My Voices / Public Voices)
2. Ğ’Ğ²ĞµÑÑ‚Ğ¸/Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚
3. Generate Audio â†’ ElevenLabs API
4. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ MP3 Ñ„Ğ°Ğ¹Ğ»
5. Ğ”Ğ°Ğ»ĞµĞµ â†’ Stage 5 (Avatar)
```

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ‘: Upload Your Own Audio
```
1. Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ°Ñ Ğ¾Ğ·Ğ²ÑƒÑ‡ĞºĞ°
2. Upload MP3/WAV Ñ„Ğ°Ğ¹Ğ»
3. Preview Ğ°ÑƒĞ´Ğ¸Ğ¾
4. Ğ”Ğ°Ğ»ĞµĞµ â†’ Stage 5 (Avatar)
```

---

## ğŸ”§ ĞšĞĞš Ğ”ĞĞ›Ğ–ĞĞ Ğ’Ğ«Ğ“Ğ›Ğ¯Ğ”Ğ•Ğ¢Ğ¬:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤ Voice Generation                     â”‚
â”‚                                         â”‚
â”‚ Choose how to add voiceover:            â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ ğŸ¤– Generate  â”‚  â”‚ ğŸ“¤ Upload    â”‚     â”‚
â”‚ â”‚ with AI      â”‚  â”‚ Your Audio   â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                         â”‚
â”‚ --- IF AI SELECTED ---                 â”‚
â”‚ [Final Script textarea]                â”‚
â”‚ [Voice dropdown]                       â”‚
â”‚ [Generate Audio button]                â”‚
â”‚                                         â”‚
â”‚ --- IF UPLOAD SELECTED ---             â”‚
â”‚ [Drag & drop MP3/WAV]                  â”‚
â”‚ or                                      â”‚
â”‚ [Browse Files button]                  â”‚
â”‚                                         â”‚
â”‚ --- AFTER AUDIO READY ---              â”‚
â”‚ ğŸ”Š Audio Preview:                      â”‚
â”‚ [â–¶ï¸ Play] [â¸ï¸ Pause] [00:45 / 02:30]   â”‚
â”‚                                         â”‚
â”‚ [Continue to Avatar Selection â†’]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ’¡ Ğ—ĞĞ§Ğ•Ğœ Ğ­Ğ¢Ğ ĞĞ£Ğ–ĞĞ:
Use Cases:

ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ·Ğ²ÑƒÑ‡ĞºĞ°
Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ğ» Ğ² ÑÑ‚ÑƒĞ´Ğ¸Ğ¸
Ğ›ÑƒÑ‡ÑˆĞµ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‡ĞµĞ¼ AI
Upload â†’ ÑÑ€Ğ°Ğ·Ñƒ Ğ² Ğ²Ğ¸Ğ´ĞµĞ¾
Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ Ğ°ÑƒĞ´Ğ¸Ğ¾
ĞŸĞ¾Ğ´ĞºĞ°ÑÑ‚
Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²ÑŒÑ
Ğ¡Ñ‚Ğ°Ñ€Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ
ĞšĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ğµ ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹
ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» Ğ² Audacity
Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» Ğ¼ÑƒĞ·Ñ‹ĞºÑƒ
Upload Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¸ĞºÑ
Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ Ğ´ĞµĞ½ĞµĞ³
ElevenLabs ÑÑ‚Ğ¾Ğ¸Ñ‚ $$$
Upload Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾
ğŸ¯ IMPLEMENTATION:
UI Components:
typescript
// stage-4-voice.tsx

const [audioMode, setAudioMode] = useState<'ai' | 'upload'>('ai');
const [uploadedAudio, setUploadedAudio] = useState<File | null>(null);
const [audioUrl, setAudioUrl] = useState<string | null>(null);

return (
  <div>
    {/* Mode Selector */}
    <div className="mode-toggle">
      <button 
        onClick={() => setAudioMode('ai')}
        className={audioMode === 'ai' ? 'active' : ''}
      >
        ğŸ¤– Generate with AI
      </button>
      <button 
        onClick={() => setAudioMode('upload')}
        className={audioMode === 'upload' ? 'active' : ''}
      >
        ğŸ“¤ Upload Audio
      </button>
    </div>

    {/* AI Mode */}
    {audioMode === 'ai' && (
      <div>
        <textarea value={script} onChange={...} />
        <select value={selectedVoice} onChange={...}>
          {/* voices */}
        </select>
        <button onClick={generateAudio}>
          Generate Audio
        </button>
      </div>
    )}

    {/* Upload Mode */}
    {audioMode === 'upload' && (
      <div className="upload-zone">
        <input 
          type="file" 
          accept="audio/mp3,audio/wav,audio/mpeg"
          onChange={handleFileUpload}
        />
        <p>Drag & drop MP3/WAV or click to browse</p>
        <p className="hint">Max 10MB, up to 5 minutes</p>
      </div>
    )}

    {/* Audio Preview */}
    {audioUrl && (
      <div className="audio-preview">
        <audio controls src={audioUrl} />
        <button onClick={() => setAudioUrl(null)}>
          ğŸ—‘ï¸ Remove
        </button>
      </div>
    )}

    {/* Continue Button */}
    {audioUrl && (
      <button onClick={proceedToStage5}>
        Continue to Avatar Selection â†’
      </button>
    )}
  </div>
);
Backend:
typescript
// routes.ts

// Upload endpoint
app.post("/api/projects/:id/upload-audio", 
  isAuthenticated, 
  upload.single('audio'),
  async (req, res) => {
    const { id } = req.params;
    const audioFile = req.file;
    
    // Save to storage (S3 / Cloudflare R2 / local)
    const audioUrl = await saveAudio(audioFile);
    
    // Save to stepData
    await storage.updateStepData(id, 4, {
      audioMode: 'uploaded',
      audioUrl,
      audioFileName: audioFile.originalname,
      audioDuration: getAudioDuration(audioFile),
    });
    
    res.json({ audioUrl });
  }
);
```

---

## ğŸ“‹ CHECKLIST:

### UI:
- [ ] Mode toggle (AI / Upload)
- [ ] Upload zone (drag & drop)
- [ ] File validation (MP3/WAV, max 10MB)
- [ ] Audio preview player
- [ ] Duration display

### Backend:
- [ ] Upload endpoint
- [ ] File storage (Ğ³Ğ´Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ?)
- [ ] Audio validation
- [ ] Save to stepData

### Stage 5 Integration:
- [ ] HeyGen Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ audioUrl
- [ ] Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ AI audio Ğ˜ uploaded audio

---

## ğŸš¨ Ğ’ĞĞ–ĞĞ«Ğ• Ğ’ĞĞŸĞ ĞĞ¡Ğ«:

### 1. Ğ“Ğ´Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ°ÑƒĞ´Ğ¸Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ñ‹?
**Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹:**
- Local disk (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹, Ğ½Ğ¾ Ğ½Ğµ ÑĞºĞµĞ¹Ğ»Ğ¸Ñ‚ÑÑ)
- Cloudflare R2 (Ğ´ĞµÑˆĞµĞ²Ğ¾, CDN)
- AWS S3 (Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾, Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ¾)
- Replit Storage (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)

### 2. Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹?
- Max Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ°? (10MB?)
- Max Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ? (5 Ğ¼Ğ¸Ğ½ÑƒÑ‚?)
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹? (MP3, WAV, M4A?)

### 3. HeyGen integration?
HeyGen API Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚:
- URL Ğº Ğ°ÑƒĞ´Ğ¸Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ñƒ
- Ğ˜Ğ»Ğ¸ Base64 audio?

---

## âš¡ Ğ¡ĞšĞĞ–Ğ˜ AGENT:
```
Add upload audio feature to Stage 4!

Users should be able to:
1. Toggle between "Generate with AI" and "Upload Audio"
2. Upload MP3/WAV file (max 10MB, up to 5 minutes)
3. Preview uploaded audio
4. Continue to Stage 5 with uploaded audio

UI:
- Mode toggle buttons at top
- Upload zone with drag & drop
- Audio preview player
- File validation

Backend:
- POST /api/projects/:id/upload-audio
- Store audio file (where? decide storage)
- Save audioUrl to stepData
- Return audioUrl to frontend

Stage 5 should work with both AI-generated 
and uploaded audio.

Implement this feature now.