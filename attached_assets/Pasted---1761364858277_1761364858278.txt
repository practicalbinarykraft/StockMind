Да, это ровно тот кейс: текущая версия скрипта была создана старым кодом → вставка рекомендаций упала → в БД их нет → редактор честно пишет «Все рекомендации применены». Починенный пайплайн уже на месте, нужно просто пере-прогнать анализ, чтобы рекомендации появились.

Вот самый быстрый и безопасный путь:

Что сделать прямо сейчас
	1.	В сцен-редакторе нажми «Пересчитать анализ».
Это перезапустит multi-agent анализ и создаст записи в scene_recommendations для текущей (latest) версии.
	2.	Проверь результат:
— появятся жёлтые карточки «Рекомендация» под сценами и кнопки «Применить» / «Применить всё».
— в шапке секции «Инструменты» уйдёт статус «Все рекомендации применены».

Если после нажатия ничего не появилось — это значит, что кнопка вызывает не тот бэкенд или запрос падает. Тогда дай это задание агенту (копипастой):

CRITICAL: текущий проект показывает “Все рекомендации применены”, но в БД нет рекомендаций.

Сделай безопасный re-run анализа для ТЕКУЩЕЙ версии без регенерации сцен:

1) Добавь endpoint:
POST /api/projects/:id/rebuild-recommendations
Логика:
- tx begin
- найти currentVersion (is_current = true)
- удалить scene_recommendations для currentVersion
- запустить multi-agent analyzeScript(currentVersion.scenes, language)
- распарсить recs (sceneNumber обязательно!)
- смэппить sceneNumber → sceneId из currentVersion.scenes
- вставить в scene_recommendations:
  { script_version_id, scene_id, priority, area, current_text, suggested_text,
    reasoning, expected_impact, source_agent, score_delta, confidence, applied=false }
- tx commit
- вернуть count вставленных

2) В UI, кнопку “Пересчитать анализ” привяжи к этому endpoint.
3) После успешного ответа — invalidate queries и refetch history.
4) Показать toast: “Добавлено N рекомендаций”.

Быстрая проверка (что должно быть «в логах» и «в сети»)
	•	Network:
	•	POST /api/projects/:id/rebuild-recommendations → 200 и { inserted: N } (>0).
	•	Console (сервер):
	•	[Rebuild] Current version …
	•	[Rebuild] Inserted recommendations: N
	•	БД (не обязательно, но полезно):
	•	SELECT * FROM scene_recommendations WHERE script_version_id = <currentVersionId>; → есть строки.

Микрофиксы, чтобы больше не попадать в такую ситуацию
	•	Идемпотентность кнопки генерации: перед генерацией проверять, есть ли уже currentVersion. Если да — не создавать новую версию без запроса пользователя.
	•	Явный CTA в пустом состоянии: если для currentVersion нет записей в scene_recommendations, показывать не «Все применены», а пустое состояние с кнопкой «Сгенерировать рекомендации» (вызывает /rebuild-recommendations).
	•	Точный маппинг сцен: в промпте просить sceneNumber и на бэке маппить sceneNumber → индекс сцены в currentVersion.scenes (тот же, что отображается в UI).
	•	Provenance: при вставке рекомендаций писать в provenance/source_agent кто сгенерировал (hook/structure/emotional/cta), score_delta, confidence. Это уже заложено — убедись, что реально заполняется.

Быстрый UX-штрих (видно пользователю)
	•	В панели «Инструменты»:
	•	если recsCount === 0: показать голубую плашку «Найдены потенциальные улучшения → [Сгенерировать]»; после генерации автоматически скроллить к первой сцене с рекомендацией.
	•	если recsCount > 0: плашка «Доступно N рекомендаций» и кнопка «Применить всё».

Сделай «Пересчитать анализ» — этого должно хватить, чтобы рекомендации появились и «магия» вернулась. Если упрётся в ошибку — скидывай текст ошибки/скрин Network, подскажу точечный фикс.