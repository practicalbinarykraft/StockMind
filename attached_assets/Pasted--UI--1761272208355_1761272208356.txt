–û—Ç–ª–∏—á–Ω—ã–π, –±–æ–ª—å—à–æ–π –∫—É—Å–æ–∫ UI üí™ –Ø –ø—Ä–æ—à—ë–ª—Å—è –ø–æ –Ω–µ–º—É –∫–∞–∫ —Ä–µ–≤—å—é–µ—Ä –∏ —Å–æ–±—Ä–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∞–≤–∫–∏/—Ä–∏—Å–∫–∏. –ù–∏–∂–µ ‚Äî –ø–æ –¥–µ–ª—É –∏ –∫–æ—Ä–æ—Ç–∫–æ.

–ß—Ç–æ –æ–∫

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ–∫—Ü–∏–π (API Keys / RSS / Instagram) –ª–æ–≥–∏—á–Ω–∞, –∫–æ–¥ —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–π.

–í–µ–∑–¥–µ –µ–¥–∏–Ω—ã–π apiRequest, invalidate –∫—ç—à–µ–π —á–µ—Ä–µ–∑ queryClient.invalidateQueries ‚Äî üëç

–î–∏–∞–ª–æ–≥–∏, —Ç–µ—Å—Ç-–∫–Ω–æ–ø–∫–∏, —Å–ª–∞–π–¥–µ—Ä—ã, —Å—Ç–∞—Ç—É—Å—ã ‚Äî UX –ø–æ–Ω—è—Ç–Ω—ã–π.

–î–ª—è Instagram –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã: —Ä—É—á–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥, –∞–≤—Ç–æ-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, ‚Äúcheck now‚Äù, –ø–æ—Ä–æ–≥–∏ ‚Äî –æ–≥–æ–Ω—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å)

–†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω –ø—Ä—è–º–æ –≤ —Ä–µ–Ω–¥–µ—Ä–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

if (!authLoading && !isAuthenticated) {
  toast(...);
  setTimeout(() => { window.location.href = "/api/login" }, 500);
  return null;
}


–¢–∞–∫ –¥–µ–ª–∞—Ç—å –Ω–µ–ª—å–∑—è: –ø–æ–±–æ—á–∫–∏ –≤ —Ä–µ–Ω–¥–µ—Ä–µ ‚Üí –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –±–∞–≥–∏.

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

const { isAuthenticated, isLoading: authLoading } = useAuth();
useEffect(() => {
  if (!authLoading && !isAuthenticated) {
    toast({ title: "Unauthorized", ... });
    window.location.href = "/api/login";
  }
}, [authLoading, isAuthenticated]);
if (authLoading) return null; // –∏–ª–∏ —Å–∫–µ–ª–µ—Ç–æ–Ω


–£—Ç–µ—á–∫–∞ –∫–ª—é—á–µ–π –≤ –∫–ª–∏–µ–Ω—Ç
–í—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ key.encryptedKey –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ø—É—Å—Ç—å –∏ –ø–æ toggle). –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –±—ç–∫–µ–Ω–¥ —É–∂–µ –æ—Ç–¥–∞—ë—Ç —Å–µ–∫—Ä–µ—Ç –≤ –æ—Ç–≤–µ—Ç–∞—Ö.

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –±—ç–∫–µ–Ω–¥ –ø–æ GET /api/settings/api-keys –¥–æ–ª–∂–µ–Ω –æ—Ç–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: id, provider, last4, isActive, updatedAt, description. –°–∞–º –∫–ª—é—á –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Ç–µ–∫–∞–µ—Ç –≤ –∫–ª–∏–µ–Ω—Ç.

–í UI –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ ****-LAST4, –∫–Ω–æ–ø–∫—É Test –∏ Delete. –ö–Ω–æ–ø–∫–∏ ‚ÄúReveal‚Äù –ª—É—á—à–µ –≤–æ–≤—Å–µ —É–±—Ä–∞—Ç—å.

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ ‚Äú—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å‚Äù, –¥–æ–±–∞–≤—å—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π POST /api/settings/api-keys/:id/reveal —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π (–ø–∞—Ä–æ–ª—å/OTP) ‚Äî –∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –∫—ç—à–∏—Ä—É–π—Ç–µ —ç—Ç–æ –≤ React.

–û–ø–æ—Ä–∞ –Ω–∞ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å –≤ –æ—Ç–≤–µ—Ç–∞—Ö –±—ç–∫–µ–Ω–¥–∞

parseInstagramSourceMutation.onSuccess –æ–∂–∏–¥–∞–µ—Ç itemCount / savedCount / skippedCount. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à —ç–Ω–¥–ø–æ–∏–Ω—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç. –ò–Ω–∞—á–µ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞–ª–∏—á–∏–µ:

const { itemCount = 0, savedCount = 0, skippedCount = 0 } = data || {};


–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è formatDistanceToNow
–°–µ–π—á–∞—Å —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –∞ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä ‚Äî –±–µ–∑ ru –ª–æ–∫–∞–ª–∏. –í –∏—Ç–æ–≥–µ ‚Äúabout 1 hour ago‚Äù.

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ:

import { formatDistanceToNow } from 'date-fns';
import { ru } from 'date-fns/locale';
// ...
formatDistanceToNow(new Date(key.updatedAt), { addSuffix: true, locale: ru })

–í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–∞–ª–∏–¥–∞—Ü–∏—è Instagram username

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∞—Å—Ç–æ –≤—Å—Ç–∞–≤–ª—è–µ—Ç @username –∏–ª–∏ –ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É.

–î–æ–±–∞–≤—å—Ç–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é:

function normalizeIgUsername(v: string) {
  const s = v.trim()
    .replace(/^@/,'')
    .replace(/^https?:\/\/(www\.)?instagram\.com\//i,'')
    .replace(/\/.*$/,'');
  return s.toLowerCase();
}
// –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:
const username = normalizeIgUsername(instagramForm.username);


–•—Ä—É–ø–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã

–ú–Ω–æ–≥–æ –≥–¥–µ –¥–µ–ª–∞–µ—Ç–µ source.parseStatus as "success" | "error" | "pending". –õ—É—á—à–µ –º–∞–ø–ø–µ—Ä:

const mapStatus = (s?: string) => (s==='success' || s==='error' || s==='pending') ? s : 'pending';


–î–ª—è parsing —É –≤–∞—Å –æ—Ç–¥–µ–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ ‚Äî –æ–∫, –Ω–æ –ª—É—á—à–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã –Ω–∞ –±—ç–∫–µ–Ω–¥–µ.

–ö–Ω–æ–ø–∫–∞ ‚Äú–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ Reels‚Äù
–í—ã –±–ª–æ–∫–∏—Ä—É–µ—Ç–µ –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ source.parseStatus === 'parsing' ‚Äî —Ö–æ—Ä–æ—à–æ. –ù–∞ –±—ç–∫–µ–Ω–¥–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å idempotency/lock, —á—Ç–æ–±—ã –¥–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞ –Ω–µ –±–∏–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞.

–ê–≤—Ç–æ-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å UI ‚Üî –±—ç–∫–µ–Ω–¥

–ö–Ω–æ–ø–∫–∞ Pause/Resume –¥–µ—Ä–≥–∞–µ—Ç PATCH /api/instagram/sources/:id/auto-update ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä —Ä–µ–∞–ª—å–Ω–æ –ø–∏—à–µ—Ç autoUpdateEnabled –∏ nextCheckAt, –∞ UI –æ–∂–∏–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ invalidate.

‚ÄúCheck Now‚Äù –¥–µ—Ä–≥–∞–µ—Ç /check-now. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ç—è–∂—ë–ª—ã–π –ø–∞—Ä—Å–∏–Ω–≥, –∞ –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–π –æ–ø—Ä–æ—Å (–∫–∞–∫ –≤ cron), –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç { newReelsCount, viralReelsCount }.

–ï–¥–∏–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ Apify
–í—ã –≤ UI —É–∫–∞–∑–∞–ª–∏ ‚Äú~$0.30/$0.70/$1.30‚Äù. –ù–æ—Ä–º, –Ω–æ –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞—Ö/–∫–æ–Ω—Ñ–∏–≥–µ (—á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å –º–∞–≥–∏–∏ –≤ JSX).

Error UX

–ú–µ—Å—Ç–∞, –≥–¥–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ run.error.message, —Ö–æ—Ä–æ—à–∏. –î–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ apiRequest —Å—Ç–æ–∏—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å message (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ JSON {message}) –∏ HTTP-–∫–æ–¥—ã.

–ú–∞–ª–µ–Ω—å–∫–∏–π DX-—Ç–≤–∏–∫ –¥–ª—è UX

–î–ª—è API Keys: –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É ‚ÄúTest‚Äù –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è anthropic, –∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤, –≥–¥–µ –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–∏–Ω–≥ (apify, kieai, heygen, elevenlabs).

–î–ª—è RSS: –∏–∫–æ–Ω–∫—É –æ—Ç–∫—Ä—ã—Ç–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (<a href={source.url} target="_blank">).

–ú–µ–ª–∫–∏–µ –ø—Ä–∏–¥–∏—Ä–∫–∏

StatusBadge –¥–ª—è pending –ª—É—á—à–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫—Ä—É—Ç–∏–ª–∫—É (–≤—ã —á–∞—Å—Ç–∏—á–Ω–æ –¥–µ–ª–∞–µ—Ç–µ —ç—Ç–æ –¥–ª—è parsing).

–°–∫–µ–ª–µ—Ç–æ–Ω—ã ‚Äî –æ–∫; –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å CTA.

data-testid –º–µ—Ç–∫–∏ ‚Äî ‚ô•Ô∏è –ø—Ä–∏–≥–æ–¥—è—Ç—Å—è –≤ e2e.

–ü—Ä–∏–º–µ—Ä –ø–∞—Ç—á–µ–π (—Å—É—Ç—å)

1) –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ useEffect

import { useEffect } from 'react';
// ...
const { isAuthenticated, isLoading: authLoading } = useAuth();
useEffect(() => {
  if (!authLoading && !isAuthenticated) {
    toast({ title: "Unauthorized", description: "Redirecting to login...", variant: "destructive" });
    window.location.href = "/api/login";
  }
}, [authLoading, isAuthenticated]);
if (authLoading || !isAuthenticated) return null;


2) –ù–µ –æ—Ç–¥–∞—ë–º –∫–ª—é—á –≤ UI

–ë—ç–∫–µ–Ω–¥: –º–µ–Ω—è–µ–º DTO —Å–ø–∏—Å–∫–∞ –∫–ª—é—á–µ–π ‚Üí –±–µ–∑ encryptedKey, –æ—Ç–¥–∞—ë–º last4.

–§—Ä–æ–Ω—Ç:

<code className="text-sm font-mono px-2 py-1 bg-muted rounded">
  ****{key.last4}
</code>
{/* —É–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É Eye/EyeOff */}


3) –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è IG username

const handleSaveInstagram = () => {
  const username = normalizeIgUsername(instagramForm.username);
  if (!username) { toast({ title: '–û—à–∏–±–∫–∞', description: '–í–≤–µ–¥–∏—Ç–µ username', variant: 'destructive' }); return; }
  addInstagramSourceMutation.mutate({ /* ... c username */ });
};


4) –õ–æ–∫–∞–ª—å –¥–∞—Ç—ã

import { ru } from 'date-fns/locale';
formatDistanceToNow(new Date(source.lastParsed), { addSuffix: true, locale: ru })