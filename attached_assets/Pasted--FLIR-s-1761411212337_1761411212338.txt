Понял задачу: сейчас всё «плоско-серое». Делаем выразительный FLIR-вид с глубиной: пост-обработку (scanlines/виньетка/зерно/блум), тени/«высоту» юнитов, окклюзию зданиями/кронами и атмосферную перспективу. Скопируй в Agent по очереди два промпта.

⸻

Промпт A — «FLIR-постпроцесс и глубина слоёв»

Сделай одним коммитом:
	1.	Рендер в буфер + шейдер

	•	Создай src/pipelines/FlirPipeline.js (Phaser WebGL pipeline) с фрагментным шейдером:
	•	вход — текстура сцены;
	•	эффекты: лёгкая виньетка, горизонтальные scanlines (частота ~2px), шум/зерно (time-varying), кривые контраста (ломаем гамму в тени), soft-threshold bloom у ярких пикселей (однопроходный fake bloom: threshold+feather).
	•	В MissionScene рендерь мир в RenderTexture rtWorld и поверх навесь FlirPipeline. HUD/модалки НЕ прогоняем через шейдер.

	2.	Слои и порядок

	•	Слои Phaser:
L0: basemap (как было),
L1: terrainOverlay (кратеры/дым),
L2: units (все юниты),
L3: fx (маркеры приказов, вспышки),
L4: HUD.
	•	Включи depth-sort по Y для L2: снизу-вверх имитирует перспективу.

	3.	Тени и «высота» юнитов

	•	Для каждого юнита добавь тень: серый эллипс под ним, alpha 0.25, scale зависит от height:
	•	infantry: height=1, shadow scale 0.9;
	•	vehicle: height=2, shadow 1.1;
	•	tank: height=2.5, shadow 1.2.
	•	При движении тень слегка смещай от «виртуального солнца» (напр., угол 135°).

	4.	Атмосферная перспектива

	•	В update() ослабляй контраст и alpha объектов дальше 1200px от центра камеры:
fade = clamp((dist-600)/1200,0,0.5) → уменьшаем alpha и чуть повышаем blur (через пост).

	5.	Окклюзия деревьями/зданиями

	•	Для «building»/«tree» фигур создай список occluders (прямоугольники/круги).
	•	Если центр юнита внутри occluder → юниту occluded=true:
— снизь яркость (tint 0xCCCCCC, alpha *= 0.35),
— добавь тонкий пунктирный контур (как «сквозь кроны»).
	•	Эффект ILLUM и SCAN временно снимают окклюзию (ярче на 12 сек/8 сек соответственно).

	6.	FX апгрейд

	•	Кратеры — тёмные мягкие круги (multiply) с лёгким «теплом» (радиальный градиент, который потом гасит bloom).
	•	Дым — слоистые альфа-спрайты с медленным шифт-шумом.

	7.	Настройки в коде

	•	В config сцены добавь visuals:

visuals:{
  scanlines: true, grain: 0.08, vignette: 0.35, bloomThreshold: 0.82, bloomFeather: 0.12
}


	•	В #debug-overlay добавь строку PIPE: FLIR on и FPS.

Критерий: мир рендерится через FLIR-шейдер (сканлайны/виньетка/зерно/мягкий блум), юниты имеют тени и «высоту», частично прячутся под кронами/зданиями; дальние объекты бледнее.

⸻

Промпт B — «Больше рельефа без токенов: псевдо-hillshade»

Сделай одним коммитом:
	1.	Полутоновая «теневая» подложка

	•	Создай src/heightfield.js с генерацией тайлового перлин-шума (seed из Math.random()), масштаб 1:800–1:1200 от мировых координат; из градиента шума вычисляй «наклон» и рисуй слой terrainOverlay как мягкое затемнение по нормали к виртуальному свету (угол 135°, интенсивность 0.25).
	•	Привяжи к мировым координатам, чтобы при панорамировании картинка «стоит на месте».

	2.	Контурные линии

	•	На terrainOverlay отрисуй полупрозрачные изогнутые линии через уровни шума (isocontours каждые 0.1), alpha 0.12 — чисто для «читабельности рельефа» под FLIR.

	3.	Синхронизация

	•	При изменении camera.scroll/zoom обновляй terrainOverlay (не чаще 15 fps → throttle).

Критерий: под канвасом ощущается мягкий рельеф (hillshade-подобная подложка и тонкие контуры); ничего не «дёргается» при перемещении.

⸻

Если хочешь реальный рельеф: потом подключим MapLibre hillshade/DEM (понадобится публичный DEM-источник или ключ), и добавим LOS/баллистику «артиллерии» по высотам.