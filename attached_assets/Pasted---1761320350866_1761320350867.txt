отличные скрины — стало ясно где именно “ломается магия”. Ниже — чёткая обратка для реплита: что сломано, как должно работать, и конкретные правки (с критичными чек-листами приёмки).

Что не так сейчас (по скринам)
	1.	Анализ → «Создано 5 сцен», но экран не переключается
– Вы остаетесь в «Анализ исходника», вместо мгновенного перехода в «Редактор сцен».
– Визуально кажется, что ничего не произошло.
	2.	Язык и контент не совпадают
– Хедер показывает «Язык: EN/UNKNOWN», при этом кнопки и рекомендации на RU/EN вперемешку.
– Нет явного контроля языка сценария / перевода исходника.
	3.	Анализ поверхностный и малоценный
– «Темы: общая тема», «Neutral» — это шум.
– Нет чёткой причины «почему» выбран формат, нет примеров хуков/кадров/структуры.
	4.	Кнопка «Применить рекомендованный» делает то же самое, что «Начать анализ»
– Для пользователя это два похожих действия без разницы в результате.
– Из уведомления «Создано 5 сцен» нельзя попасть в эти сцены.
	5.	Отсутствует “магия редактора” из ТЗ
– Нет инлайн-редактирования с рекомендациями per-scene, «Применить все», «История/откат», «Пересчитать».
	6.	Источник в сайдбаре обезличен
– Шаг 1 не отражает выбранный тип (News/RSS/Reel/Manual) и ключевой атрибут (язык, длина, score).

Как должно быть (бизнес-логика UX)

A. Stage 3 — один экран, две фазы
	1.	Фаза «Обзор источника»: пользователь видит полный текст/перевод, жмёт «Сгенерировать сценарий».
	2.	Автоматический свитч → «Редактор сцен»: сцены, рекомендации, «Применить», «Применить все», «История», «Пересчитать».

B. После генерации сценария:
– Toast: «Сценарий создан: 5 сцен • Формат: Hook & Story».
– Автоскролл/навигация к первой сцене.
– В панели сверху — “Все рекомендации применены / N рекомендаций доступно”.

C. Прозрачность языка
– Переключатель «Язык сценария: RU/EN» перед генерацией (по умолчанию локаль пользователя).
– В модалке статьи: «Перевести источник полностью» (переключатель), предпросмотр на выбранном языке.

D. Рекомендация формата — с обоснованием
– «Почему» (3–4 маркера из анализа), «Чего ожидать» (Retention +15%, Saves +20%), примеры первого кадра/хука.

Конкретные правки (задачи для реплита)

1) Жёсткий свитч в редактор сцен после генерации

Frontend
	•	В stage-3-ai-analysis.tsx после успешного POST /generate-script:
	•	await refetch(['script-history', projectId])
	•	setMode('editor') (или hasGeneratedScript = true)
	•	scrollIntoView(#scene-1)
	•	Toast с CTA: «Открыть редактор сцен» (клик → setMode('editor')).
	•	На время генерации блокируем кнопки, меняем текст на «Генерируем…».

Acceptance
	•	После клика «Применить рекомендованный» в ≤1–2 сек UI переключается на «Редактор сцен».
	•	Нет возврата к «Анализ исходника» без действия пользователя.

2) Единый источник правды для наличия сценария

Frontend
	•	Все проверки «есть ли сценарий» читают только GET /api/projects/:id/script-history (не /script-versions).
	•	Фича-флаг не должен отключать запрос истории.

Backend
	•	POST /generate-script в ответе возвращает scriptVersionId и массив сцен.

Acceptance
	•	script-history всегда содержит актуальную версию сразу после генерации.
	•	В консоли нет 404 по несуществующим эндпоинтам.

3) Управление языком

Frontend
	•	В Source-баре добавить контрол «Язык сценария» (RU/EN).
	•	В модалке статьи добавить «Перевести источник» (on/off).
	•	Перед генерацией сценария отправлять targetLanguage.

Backend
	•	Проброс targetLanguage в промпт.
	•	В анализе источника хранить detectedSourceLang, в сценарии — scriptLang.

Acceptance
	•	Выбранный язык отражается в шапке («Язык сценария: RU»).
	•	Текст сцен полностью на выбранном языке.

4) Рекомендация формата — содержательная

Backend
	•	В /analyze-source вернуть:
	•	why (3–5 пунктов),
	•	expectedImpact (retention/saves),
	•	firstFrameIdeas (3 идеи кадра),
	•	hookOptions (3 варианта первой реплики).

Frontend
	•	В карточке «Рекомендованный формат» показать эти поля (аккордеон «Показать детали»).

Acceptance
	•	В UI объяснение «почему» с конкретикой (не «общая тема»).
	•	Пользователь видит примеры первого кадра/хука до генерации.

5) “Магия редактора” (минимум)

Frontend
	•	Карточка сцены: textarea (inline), бейджи рекомендаций, кнопка «Применить».
	•	«Применить все» (bulk) — сверху редактора.
	•	«История» — модалка: слева версии, справа diff (уже заложено — убедиться, что подключено).

Backend
	•	Уже существуют apply-scene-recommendation, apply-all, revert-to-version — убедиться, что они используются.

Acceptance
	•	Применение одной/всех рекомендаций создаёт новую версию и видимый diff.
	•	«Пересчитать» появляется после ручного редактирования.

6) Сайдбар: более информативный шаг 1

Frontend
	•	В левом шаге «Source Selection» отображать: тип (News/Reel/Manual), язык источника, длину/score (если есть).

Acceptance
	•	В сайдбаре всегда понятно, что именно выбрано на шаге 1.

7) Технические гарантии (от зацикливаний)

Frontend
	•	Idempotency: генерируем idempotencyKey и шлём в /generate-script.
	•	Блокируем повторный клик, пока не придёт ответ.

Backend
	•	Если версия с данным idempotencyKey уже есть — возвращаем её.

Acceptance
	•	Двойной клик по «Применить рекомендованный» не создаёт дубликатов.
	•	Нет визуального “мигания”/возврата в фазу анализа.

Быстрые UX-улучшения (1-кнопочные)
	•	«Показать статью» → в модалке две вкладки: Original / Translated (переключатель запоминается).
	•	Toast с действиями:
– «Сценарий создан: 5 сцен» • [Открыть редактор] [Отмена]
	•	Под форматом — подсказка: «Не подходит? Выбрать другой формат» (вторичная кнопка).
	•	В «Анализ исходника» добавить мини-чеклист пригодности контента: «Есть ли конкретика/новизна/эмоция/сцены?».

Что написать реплиту (готовый блок)
	1.	После POST /generate-script UI должен автоматически переключаться на «Редактор сцен» с автоскроллом к сцене 1. Сейчас остаёмся на «Анализ исходника». Исправьте: refetch(script-history) → setMode('editor').
	2.	Все проверки «есть ли сценарий» перевести на GET /api/projects/:id/script-history. Убрать обращения к несуществующему /script-versions.
	3.	Добавить управление языком (RU/EN) до генерации. Пробрасывать targetLanguage и отрисовывать в шапке «Язык сценария».
	4.	Обновить /analyze-source: вернуть why, expectedImpact, firstFrameIdeas, hookOptions. Показать это в UI карточки «Рекомендованный формат».
	5.	Подключить «магический» редактор: inline-edit, рекомендации per-scene, «Применить все», «История» (diff).
	6.	В сайдбаре у шага 1 показывать тип источника, язык и длину/score.
	7.	Idempotency на генерацию: ключ с фронта, дедупликация на бэке.

Приёмочные тесты (чек-лист)
	•	Клик «Начать анализ» не запускает генерацию сценария — только анализ и рекомендацию.
	•	Клик «Применить рекомендованный» → через ≤2 сек вижу «Редактор сцен», сцен 5+, видны рекомендации.
	•	Язык сценария соответствует выбранному переключателю.
	•	«Выбрать другой формат» действительно меняет структуру сцен.
	•	«Применить все» создаёт новую версию и меняет текст сцен.
	•	«История» показывает diff (быстро сравнить «было/стало»).
	•	Двойной клик по «Применить рекомендованный» не создаёт дублей.
	•	Сайдбар шаг 1 показывает тип/язык/длину/score.

С этим списком команда сможет быстро довести UX до «магии», не ломая архитектуру и не катая новые этапы.