–û—Ç–ª–∏—á–Ω–æ üëç
–í–æ—Ç –≥–æ—Ç–æ–≤–æ–µ –Ω–æ–≤–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è Replit, –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –±–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ Stage, –Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ —á–∏—Å—Ç–æ–≥–æ UX.

‚∏ª

üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Stage 3 (AI Analysis) –∏ –ª–æ–≥–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

üéØ –¶–µ–ª—å

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É AI pipeline, —É–±—Ä–∞–≤ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –∏ —É–ª—É—á—à–∏–≤ UX:
	‚Ä¢	Stage 3 –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—å–∏ (pre-check) –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è –≤ –æ–¥–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.
	‚Ä¢	–ü–æ–ª–Ω—ã–π –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –≥–æ—Ç–æ–≤–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏.
	‚Ä¢	–û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É –≤–µ—Ä—Å–∏–π (current / candidate), –∏—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
	‚Ä¢	–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –∫—ç—à–∞, —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –æ–∑–≤—É—á–∫–∏.

‚∏ª

‚öôÔ∏è –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

üîπ –¢–µ–∫—É—â–∏–π flow

Stage 3 –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é –Ω–æ–≤–æ—Å—Ç—å (5 –∞–≥–µ–Ω—Ç–æ–≤), –ø–æ—Ç–æ–º —Å–æ–∑–¥–∞—ë—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π, –ø–æ—Ç–æ–º Stage 4 —Å–Ω–æ–≤–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π.
‚Üí –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–¥–µ—Ä–∂–∫–∏.

üîπ –ù–æ–≤—ã–π flow

Stage 3 (–æ–¥–∏–Ω —à–∞–≥):
	1.	–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç—å—é ‚Üí –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑¬ª.
	2.	Backend –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ª—ë–≥–∫–∏–π pre-check (—è–∑—ã–∫, –¥–ª–∏–Ω–∞, –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –±–∞–∑–æ–≤–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å).
	3.	–ï—Å–ª–∏ –≤—Å—ë –æ–∫ ‚Äî —Å—Ä–∞–∑—É –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è (generateScript()).
	4.	–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è —Å candidate –≤–µ—Ä—Å–∏–µ–π (v1).
	5.	Stage 4 (–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ ¬´–ê–Ω–∞–ª–∏–∑ —Å—Ü–µ–Ω–∞—Ä–∏—è¬ª) –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—ã–π –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —É–∂–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (5 –∞–≥–µ–Ω—Ç–æ–≤ + –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä).

‚∏ª

üß© Backend

1. POST /api/projects/:id/analyze-source ‚Üí –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ /precheck-source

–ó–∞–¥–∞—á–∞: –ª—ë–≥–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—å–∏.
–ú–æ–¥–µ–ª—å: Claude / GPT-mini
–í—ã—Ö–æ–¥:

{
  "language": "EN",
  "length": 176,
  "keywords": ["AI", "school", "Baltimore"],
  "formatHint": "Hook & Story",
  "warnings": []
}

–í—Ä–µ–º—è: < 2 —Å–µ–∫
–°—Ç–æ–∏–º–æ—Å—Ç—å: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è

‚∏ª

2. POST /api/projects/:id/generate-script

–ó–∞–¥–∞—á–∞: —Å–æ–∑–¥–∞—Ç—å candidate —Å—Ü–µ–Ω–∞—Ä–∏–π (scriptVersion v1) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ç–∞—Ç—å–∏.
–ü—Ä–æ—Ü–µ—Å—Å:
	‚Ä¢	–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç pre-check,
	‚Ä¢	—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç 3‚Äì6 —Å—Ü–µ–Ω,
	‚Ä¢	–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç language (–∏–∑ pre-check),
	‚Ä¢	—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ script_versions –∫–∞–∫ is_candidate=true.
–í—ã—Ö–æ–¥:

{
  "versionId": "uuid",
  "scenes": [{ "index": 1, "text": "..." }],
  "language": "RU",
  "format": "Hook & Story"
}


‚∏ª

3. POST /api/projects/:id/analyze-script

–ó–∞–¥–∞—á–∞: –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —É–∂–µ –≥–æ—Ç–æ–≤–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è (Stage 4).
–ê–≥–µ–Ω—Ç—ã:
	1.	Hook Expert
	2.	Structure Analyst
	3.	Emotional Analyst
	4.	CTA Analyst
	5.	Architect (–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)

–í—Ö–æ–¥: versionId + scriptText
–í—ã—Ö–æ–¥:

{
  "overallScore": 78,
  "verdict": "strong",
  "metrics": {
    "hook": 85,
    "structure": 72,
    "emotional": 78,
    "cta": 45
  },
  "recommendations": [...],
  "strengths": [...],
  "weaknesses": [...],
  "predictedMetrics": {
    "retention": "62-72%",
    "ctr": "4.2-5.8%",
    "shares": "850-1200 / 10k views"
  }
}

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤:
script_versions.metrics + scene_recommendations

‚∏ª

4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
	‚Ä¢	–§–æ—Ä–º—É–ª—ã structureScore|emotionalScore|ctaScore –¥–æ–ª–∂–Ω—ã –≤—Å–µ–≥–¥–∞ –±—Ä–∞—Ç—å—Å—è —Å –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏.
	‚Ä¢	–ú–µ—Ç—Ä–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ —Å–≤—è–∑—ã–≤–∞—Ç—å –ø–æ versionId.
	‚Ä¢	–ü–æ—Å–ª–µ –ª—é–±–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å invalidateQueries(['/api/projects', id, 'script-history'], { exact:false }).

‚∏ª

5. GET /api/projects/:id/versions/active

–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É ‚ÄúactiveVersion‚Äù:
	‚Ä¢	–µ—Å–ª–∏ –µ—Å—Ç—å candidate ‚Üí –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ;
	‚Ä¢	–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª ‚Äú–ü—Ä–∏–Ω—è—Ç—å‚Äù ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å is_current=true –∏ –≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—É—é —Ç–µ–∫—É—â—É—é.

‚∏ª

üíª Frontend

1. Stage 3 (client/src/components/project/stages/stage-3-ai-analysis.tsx)

–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ ¬´–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑¬ª:

const handleStartAnalysis = async () => {
  setIsLoading(true);
  await api.post(`/projects/${project.id}/precheck-source`);
  await api.post(`/projects/${project.id}/generate-script`);
  setIsLoading(false);
  router.push(`/projects/${project.id}/stage-4-editor`);
};

UI:
	‚Ä¢	–≤–æ –≤—Ä–µ–º—è pre-check –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
‚Äú–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫‚Ä¶‚Äù
	‚Ä¢	–ø–æ—Å–ª–µ ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç—á—ë—Ç (—è–∑—ã–∫, –¥–ª–∏–Ω–∞, –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, —Ñ–æ—Ä–º–∞—Ç).
	‚Ä¢	–∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ Stage 4 (—Ä–µ–¥–∞–∫—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è).

‚∏ª

2. –†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è (stage-4-editor / scene-editor.tsx)

–õ–æ–≥–∏–∫–∞:
	‚Ä¢	–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å candidate –≤–µ—Ä—Å–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å).
	‚Ä¢	–ö–Ω–æ–ø–∫–∞ ¬´–ê–Ω–∞–ª–∏–∑ —Å—Ü–µ–Ω–∞—Ä–∏—è¬ª = useMutation ‚Üí /analyze-script.
	‚Ä¢	–ü–æ—Å–ª–µ onSuccess:
	‚Ä¢	invalidate script-history
	‚Ä¢	invalidate scene-recommendations
	‚Ä¢	–æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ —Ä–µ—Ü–µ–Ω–∑–∏–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞.

‚∏ª

3. Compare modal (compare-modal.tsx)

–î–æ–±–∞–≤–∏—Ç—å:
	‚Ä¢	–æ–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ metrics (polling –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫ –¥–æ status=done);
	‚Ä¢	–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ‚Äú–í –ø—Ä–æ—Ü–µ—Å—Å–µ –∞–Ω–∞–ª–∏–∑–∞‚Ä¶‚Äù –≤–º–µ—Å—Ç–æ –Ω—É–ª–µ–π;
	‚Ä¢	–ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å beforeVersionId –∏ afterVersionId —è–≤–Ω–æ.

‚∏ª

4. Stage 5 (Voice Generation)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å activeVersionId:

const { data: activeVersion } = useQuery(['/api/projects', project.id, 'versions', 'active']);

	‚Ä¢	–µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è candidate ‚Üí –æ–∑–≤—É—á–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–∞–∫ ‚Äú—á–µ—Ä–Ω–æ–≤–∏–∫‚Äù;
	‚Ä¢	–µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è current ‚Üí –æ–±—ã—á–Ω—ã–π workflow.

‚∏ª

üß† UX –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ë—ã–ª–æ	–°—Ç–∞–ª–æ
Stage 3: –∞–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ—Å—Ç–∏ (5 –∞–≥–µ–Ω—Ç–æ–≤)	Stage 3: pre-check + –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è
Stage 4: –∞–Ω–∞–ª–∏–∑ —Å—Ü–µ–Ω–∞—Ä–∏—è (–ø–æ–≤—Ç–æ—Ä–Ω–æ)	Stage 4: –ø–µ—Ä–≤—ã–π –∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑
–î–≤–æ–π–Ω–∞—è —Ç—Ä–∞—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤	1 –∞–Ω–∞–ª–∏–∑ –Ω–∞ —Å—Ü–µ–Ω–∞—Ä–∏–π
‚Äú–ü—É—Å—Ç–∞—è‚Äù –æ–∑–≤—É—á–∫–∞ –ø—Ä–∏ candidate	–û–∑–≤—É—á–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ activeVersion
–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∫—ç—à–∞	–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∏ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞


‚∏ª

‚úÖ –¶–µ–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
	‚Ä¢	–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ (—ç–∫–æ–Ω–æ–º–∏—è 30‚Äì40% —Ç–æ–∫–µ–Ω–æ–≤).
	‚Ä¢	–£—Å–∫–æ—Ä–∏—Ç—å UX: –æ—Ç –≤—ã–±–æ—Ä–∞ —Å—Ç–∞—Ç—å–∏ –¥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è ‚â§ 5 —Å–µ–∫.
	‚Ä¢	–£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É: 1 pipeline –≤–º–µ—Å—Ç–æ 2.
	‚Ä¢	–°–¥–µ–ª–∞—Ç—å Stage 3 ‚Äú–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º –º–æ—Å—Ç–æ–º‚Äù, –∞ –Ω–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º.

‚∏ª

üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
	1.	Stage 3 —Å–æ–∑–¥–∞—ë—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–æ—Ä.
	2.	–ö–Ω–æ–ø–∫–∞ ‚Äú–ê–Ω–∞–ª–∏–∑ —Å—Ü–µ–Ω–∞—Ä–∏—è‚Äù –∑–∞–ø—É—Å–∫–∞–µ—Ç –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–æ–≤ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏.
	3.	–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ (–Ω–µ –Ω—É–ª–∏).
	4.	–û–∑–≤—É—á–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞, —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ activeVersion.

‚∏ª

–•–æ—á–µ—à—å ‚Äî —è —Å–¥–µ–ª–∞—é –∏–∑ —ç—Ç–æ–≥–æ –≥–æ—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É –¥–ª—è Replit (–≤ —Ñ–æ—Ä–º–∞—Ç–µ agent prompt + task list), —á—Ç–æ–±—ã —Ç—ã –º–æ–≥ –ø—Ä—è–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä–∞–±–æ—á–∏–π backlog?