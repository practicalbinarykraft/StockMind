Абсолютно понял. Ниже — коротко «как это будет выглядеть для пользователя», и сразу же готовое ТЗ для реплита (что править в фронте/бэке, тексты кнопок/тостов, статусы, API, критерии приёмки). Это ровно твой флоу, без «черновиков» и другой путаницы.

Как это выглядит для пользователя (по-человечески)
	1.	Я вижу сгенерированный сценарий (5–7 сцен).
	2.	Жму Анализ сценария → через ~10–30 сек у каждой сцены появляются:
	•	бейдж Score (0–100),
	•	Рекомендация AI + кнопка Применить.
	3.	Применяю 2–3 рекомендации → сцены помечаются «Изменена» → активируется Сохранить новую версию.
	4.	Жму Сохранить новую версию → версия vN+1 сохраняется, и автоматически считается её фактический скоринг.
	5.	Жму Сравнить сценарии → модалка с ДО/ПОСЛЕ:
	•	вкладка Сцены: тексты слева/справа, баллы по сценам и Δ, подсветка изменений;
	•	вкладка Метрики: общий балл, breakdown (Hook/Structure/Emotion/CTA), рецензия AI-архитектора, дельты.
	6.	Внизу модалки: Перейти к озвучке или Вернуться к редактированию (делать ещё итерации).

⸻

ТЗ для реплита

1) Убрать «черновик», переименования
	•	В Stage 3 убрать все упоминания «черновик/кандидат».
	•	Правая панель «Инструменты»:
	•	Анализ сценария (primary)
	•	Сохранить новую версию (disabled пока нет изменений)
	•	Сравнить сценарии (ДО/ПОСЛЕ) (disabled, если нет ≥2 версий; кликабельна сразу после сохранения новой)
	•	Все версии (история)

Тосты/тексты:
	•	«Запущен анализ сценария…»
	•	«Версия сохранена. Считаем оценки новой версии…»
	•	«Готово: сравнение доступно»

2) Фронтенд: поток и состояния (Stage 3)
	•	Кнопка Анализ сценария:
	•	POST /api/projects/:id/analysis/run (идемпотентно).
	•	Панель прогресса: шаги «Hook → Structure → Emotion → CTA → Сводка».
	•	По готовности: у каждой сцены появляется score + блок «Рекомендация AI» с кнопкой Применить.
	•	Применение рекомендаций:
	•	При изменении текста сцены — бейдж «Изменена».
	•	Если есть ≥1 изменённая сцена → активировать Сохранить новую версию.
	•	Кнопка Сохранить новую версию:
	•	POST /api/projects/:id/versions (с телом текущих сцен).
	•	После успешного сохранения автоматически запускать анализ новой версии:
POST /api/projects/:id/analysis/run?version=vN+1.
	•	Показать тост «Версия сохранена. Считаем оценки новой версии…».
	•	Кнопка Сравнить сценарии становится кликабельной сразу.
	•	Кнопка Сравнить сценарии (ДО/ПОСЛЕ):
	•	Открывает модалку; если анализ новой версии ещё идёт — показываем skeleton/спиннер и догружаем.
	•	Данные для модалки: GET /api/projects/:id/compare?from=vN&to=vN+1.

3) Модалка «Сравнить сценарии»
	•	Вкладки:
	•	Сцены:
	•	слева vN (ДО), справа vN+1 (ПОСЛЕ);
	•	у каждой сцены: Score ДО / ПОСЛЕ / Δ;
	•	подсветка изменённых сцен.
	•	Метрики:
	•	общий балл ДО/ПОСЛЕ и Δ;
	•	breakdown (Hook/Structure/Emotion/CTA);
	•	рецензия AI-архитектора для каждой версии.
	•	Низ модалки:
	•	Перейти к озвучке (Stage 4);
	•	Вернуться к редактированию (остаёмся в vN+1, можно снова нажать «Анализ сценария», применить советы, сохранить vN+2…).

4) Бэкенд: эндпоинты (новые/уточнённые)
	•	POST /api/projects/:id/analysis/run[?version=v]
Запускает анализ для текущей или указанной версии. Возвращает jobId.
	•	GET  /api/projects/:id/analysis/status?version=v
Возвращает { status: queued|running|done|error, step, progress, error? }.
	•	POST /api/projects/:id/versions
Создаёт vN+1 из текущего текста сцен.
	•	GET  /api/projects/:id/compare?from=vN&to=vN+1
Возвращает:

{
  "from": { "version": "vN",   "scenes": [...], "score": 72, "breakdown": {"hook":..., "structure":..., "emotion":..., "cta":...}, "review": "..." },
  "to":   { "version": "vN+1", "scenes": [...], "score": 79, "breakdown": {...}, "review": "..." },
  "delta": { "score": +7, "hook": +4, "structure": +2, "emotion": +1, "cta": 0 }
}


	•	Идемпотентность: для /analysis/run используйте Idempotency-Key (по версии) и защиту от двойного запуска.
	•	Retry/backoff уже есть — оставить. TTL анализа ≥120с.

5) Ошибки/крайние случаи
	•	Если анализ новой версии >2 мин:
	•	Баннер вверху: «Пересчёт занял слишком долго. [Повторить] [Продолжить]»
	•	Модалка «Сравнить» открывается, но показывает спиннер и автодогрузку.
	•	Если анализ упал → показать «Повторить анализ» (не трогая версии).
	•	Для пустых сцен из LLM — использовать вашу normalizeScenes() и «repair попытки» перед 422.

6) Тексты интерфейса (точно)
	•	Анализ сценария
Tooltip: «Покажем баллы по сценам и рекомендации».
	•	Сохранить новую версию
Tooltip: «Зафиксировать правки; пересчитаем баллы новой версии».
	•	Сравнить сценарии (ДО/ПОСЛЕ)
Tooltip: «Сравнить текущую и предыдущую версии».
	•	Тосты:
	•	«Запущен анализ сценария…»
	•	«Версия сохранена. Считаем оценки новой версии…»
	•	«Сравнение готово» / «Результаты догружаются…»

7) Критерии приёмки (DoD)
	1.	После генерации доступна Анализ сценария; через ≤30с видны баллы/советы по сценам + рецензия архитектора.
	2.	После любых правок активируется Сохранить новую версию.
	3.	После сохранения версия vN+1 автоматически анализируется; Сравнить сценарии открывается сразу (скелетон до готовности).
	4.	Модалка имеет вкладки Сцены и Метрики, показывает фактические баллы ДО/ПОСЛЕ и дельты.
	5.	Термин «черновик» отсутствует в UI/коде.
	6.	Любой таймаут/ошибка анализа не блокирует сохранение версии и сравнение — есть понятные действия «Повторить»/«Продолжить».

⸻

Уже исправлено
	•	Перевод: теперь переводится и заголовок, и тело статьи.

Если нужно, могу дописать точные сигнатуры типов для фронта (TS интерфейсы ответа), готовые тексты тостов/баннеров и имена событий для аналитики — скажи, добавлю.