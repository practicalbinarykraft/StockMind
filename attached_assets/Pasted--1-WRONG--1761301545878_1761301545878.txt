üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò –ù–ê–ô–î–ï–ù–´!
‚ùå –ü–†–û–ë–õ–ï–ú–´:
1. –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
–°–ï–ô–ß–ê–° (WRONG):
–í—ã–±—Ä–∞–ª —Å—Ç–∞—Ç—å—é ‚Üí –°—Ä–∞–∑—É "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫..."

–î–û–õ–ñ–ù–û:
–í—ã–±—Ä–∞–ª —Å—Ç–∞—Ç—å—é ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—å—é + –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑"
```

### **2. –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ vs —è–∑—ã–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**
```
–ü—Ä–æ–±–ª–µ–º–∞:
- –°—Ç–∞—Ç—å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- –ü–æ–∫–∞–∑–∞–Ω–æ "–Ø–∑—ã–∫: RU" 
- –ê–Ω–∞–ª–∏–∑ –Ω–∞ —Å–º–µ—Å–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∏ —Ä—É—Å—Å–∫–æ–≥–æ
- –ù–µ—Ç –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏"

–ü–æ—á–µ–º—É:
–Ø–∑—ã–∫: RU = —è–∑—ã–∫ –ò–ù–¢–ï–†–§–ï–ô–°–ê, –Ω–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞!
```

### **3. –ë–µ—Å–ø–æ–ª–µ–∑–Ω—ã–π –∞–Ω–∞–ª–∏–∑**
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –¢–µ–º—ã: "–û–±—â–∞—è —Ç–µ–º–∞"
- –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: "Neutral"
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "Sonic, developed, device..."

–ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ü–æ—á–µ–º—É —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç?
- –ß—Ç–æ —Ö–æ—Ä–æ—à–µ–≥–æ –≤ —Å—Ç–∞—Ç—å–µ?
- –ö–∞–∫–æ–π Score —É –∏—Å—Ç–æ—á–Ω–∏–∫–∞?
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –≤—ã–±–æ—Ä–∞
```

### **4. –ó–ê–¶–ò–ö–õ–ò–í–ê–ù–ò–ï (–∫—Ä–∏—Ç–∏—á–Ω–æ!)**
```
Flow:
1. –ù–∞–∂–∞–ª "–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π"
2. –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω—è–µ–º..."
3. –≠–∫—Ä–∞–Ω —Å—Ç–∞–ª –±–µ–ª—ã–º
4. –í–µ—Ä–Ω—É–ª—Å—è –∫ –¢–û–ú–£ –ñ–ï —ç–∫—Ä–∞–Ω—É –∞–Ω–∞–ª–∏–∑–∞
5. –§–æ—Ä–º–∞—Ç –ò–ó–ú–ï–ù–ò–õ–°–Ø (Hook & Story ‚Üí –¥—Ä—É–≥–æ–π)

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:
- –ù–µ —Å–æ–∑–¥–∞–ª—Å—è —Å–∫—Ä–∏–ø—Ç
- –ù–µ –ø–µ—Ä–µ—à–ª–æ –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
- –õ–æ–≥–∏–∫–∞ —Å–ª–æ–º–∞–Ω–∞

üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´:
–ì–¥–µ –±–∞–≥ –≤ –∫–æ–¥–µ:
typescript// stage-3-ai-analysis.tsx

const hasGeneratedScript = !!project.scriptVersions?.length;

// –ü—Ä–æ–±–ª–µ–º–∞ 1: –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
useEffect(() => {
  if (!sourceAnalysis && !isAnalyzing) {
    handleAnalyzeSource(); // ‚Üê –ê–í–¢–û–ó–ê–ü–£–°–ö!
  }
}, []);

// –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ—Å–ª–µ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–∫—Ä–∏–ø—Ç
const handleApplyFormat = async (formatId: string) => {
  // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç + –≤–µ—Ä—Å–∏—è
  // –ù–æ —ç—Ç–æ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç!
  // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –∫ –∞–Ω–∞–ª–∏–∑—É
};

// –ü—Ä–æ–±–ª–µ–º–∞ 3: hasGeneratedScript –≤—Å–µ–≥–¥–∞ false
// –ü–æ—Ç–æ–º—É —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è!
// –ü–æ—ç—Ç–æ–º—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è Mode 1 (Source Review) –ø–æ—Å—Ç–æ—è–Ω–Ω–æ

üõ†Ô∏è –ß–¢–û –ù–£–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨:
FIX 1: –£–±—Ä–∞—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
typescript// –ë–´–õ–û (BAD):
useEffect(() => {
  if (!sourceAnalysis) {
    handleAnalyzeSource(); // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫
  }
}, []);

// –î–û–õ–ñ–ù–û (GOOD):
// –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑"
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∞–µ—Ç –∫–æ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å

{!sourceAnalysis ? (
  <div>
    <SourceSummaryBar />
    <Button onClick={handleAnalyzeSource}>
      –ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞
    </Button>
  </div>
) : (
  <SourceAnalysisCard />
  <RecommendedFormatBox />
)}
FIX 2: –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–∫—Ä–∏–ø—Ç–∞
typescriptconst handleApplyFormat = async (formatId: string) => {
  setIsGenerating(true);
  
  try {
    // 1. Generate script from article
    const scriptResponse = await fetch(
      `/api/projects/${project.id}/generate-script`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          formatId,
          sourceId: project.stepData.newsItemId
        })
      }
    );
    
    const { script, scenes } = await scriptResponse.json();
    
    // 2. Create initial script version
    const versionResponse = await fetch(
      `/api/projects/${project.id}/create-initial-version`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ scenes })
      }
    );
    
    // 3. Analyze generated script (not source!)
    const analysisResponse = await fetch(
      `/api/projects/${project.id}/analyze-script`,
      {
        method: 'POST'
      }
    );
    
    // 4. Refresh project to show Scene Editor
    await refetchProject();
    
  } catch (error) {
    toast.error('Failed to generate script');
  } finally {
    setIsGenerating(false);
  }
};
FIX 3: –£–ª—É—á—à–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
typescript// Backend: POST /api/projects/:id/analyze-source

// –î–û–ë–ê–í–ò–¢–¨:
{
  sourceScore: 72, // Score —Å—Ç–∞—Ç—å–∏
  language: "en",  // –Ø–∑—ã–∫ –ö–û–ù–¢–ï–ù–¢–ê
  
  analysis: {
    topics: ["Technology", "Fire Safety", "Innovation"],
    sentiment: "Positive",
    keywords: [...],
    
    // –î–û–ë–ê–í–ò–¢–¨:
    strengths: [
      "–ù–æ–≤–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ø—Ä–∏–≤–ª–µ—á—ë—Ç –≤–Ω–∏–º–∞–Ω–∏–µ",
      "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (–¥–æ–º)"
    ],
    
    viralPotential: "Medium-High",
    
    whyThisFormat: [
      "Hook & Story –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞",
      "–ê—É–¥–∏—Ç–æ—Ä–∏—è —Ö–æ—Ä–æ—à–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏"
    ]
  },
  
  recommendation: {
    formatId: "hook_story",
    name: "Hook & Story",
    reasoning: "–ö–æ–Ω—Ç–µ–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç —Å–∏–ª—å–Ω–æ–≥–æ —Ö—É–∫–∞ –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è",
    whyBetter: "–§–æ—Ä–º–∞—Ç Hook & Story –Ω–∞ 15% —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π –æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö"
  }
}
FIX 4: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —è–∑—ã–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
typescript// SourceSummaryBar

<Badge>
  –ò—Å—Ç–æ—á–Ω–∏–∫: {detectLanguageName(article.content)} // ‚Üê –Ω–µ RU!
</Badge>

// –ï—Å–ª–∏ —è–∑—ã–∫ –Ω–µ —Ä—É—Å—Å–∫–∏–π - –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–≤–æ–¥–∞
{sourceLanguage !== 'ru' && (
  <Button onClick={handleTranslate}>
    –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
  </Button>
)}
```

---

## üí¨ –ß–¢–û –°–ö–ê–ó–ê–¢–¨ REPLIT:
```
CRITICAL BUGS FOUND DURING TESTING! üî¥

User flow is broken. Here's what happened:

‚ùå BUG 1: Auto-start analysis
- Selected article ‚Üí Analysis starts IMMEDIATELY
- User can't review article first
- No control over when to analyze

FIX: Show article first, add "Start Analysis" button

‚ùå BUG 2: Language confusion
- Article is in English
- UI shows "–Ø–∑—ã–∫: RU" (wrong!)
- Analysis has mixed English/Russian
- No translate button

FIX: 
- Detect CONTENT language (not UI language)
- Add translate button if not Russian
- Ensure analysis is in Russian

‚ùå BUG 3: Useless analysis
- Shows generic "–û–±—â–∞—è —Ç–µ–º–∞"
- No explanation why format is recommended
- No source Score visible
- Not actionable

FIX: Add:
- Source Score (72/100)
- Strengths of content
- Why this format works
- Expected impact details

‚ùå BUG 4: INFINITE LOOP (CRITICAL!)
- Clicked "–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π"
- Screen went white
- Came back to SAME analysis screen
- Format changed for no reason
- Script was NOT generated!

ROOT CAUSE:
handleApplyFormat() doesn't create script version!
So hasGeneratedScript stays false
So Mode 1 (Source Review) shows again
Infinite loop!

FIX REQUIRED:
1. handleApplyFormat() must:
   - Generate script from article
   - Create script_version
   - Analyze SCRIPT (not source again!)
   - Transition to Scene Editor

2. Add proper backend endpoint:
   POST /api/projects/:id/generate-script
   - Takes formatId + sourceId
   - Generates scenes using AI
   - Returns script text + scene breakdown

3. Remove auto-analysis on mount
   - Show "Start Analysis" button
   - Let user control flow

4. Fix language detection
   - Show actual content language
   - Add translate option

PRIORITY: FIX #4 first (blocking bug!)
Then FIX #1, #2, #3

DO NOT test Scene Editor yet!
Fix the generation flow first!
```

---

## üéØ –ü–õ–ê–ù –§–ò–ö–°–ê:
```
PRIORITY 1 (BLOCKING): Fix infinite loop
‚îú‚îÄ Create POST /api/projects/:id/generate-script
‚îú‚îÄ Implement proper script generation
‚îú‚îÄ Create initial script version
‚îú‚îÄ Transition to Scene Editor mode
‚îî‚îÄ Test: Click Apply ‚Üí See Scene Editor

PRIORITY 2: Remove auto-analysis
‚îú‚îÄ Remove useEffect auto-start
‚îú‚îÄ Add "Start Analysis" button
‚îú‚îÄ User controls when to analyze
‚îî‚îÄ Test: Select article ‚Üí See button ‚Üí Click ‚Üí Analyze

PRIORITY 3: Fix language handling
‚îú‚îÄ Detect content language correctly
‚îú‚îÄ Show "Translate" button if not Russian
‚îú‚îÄ Ensure analysis in Russian
‚îî‚îÄ Test: English article ‚Üí See translate option

PRIORITY 4: Improve analysis quality
‚îú‚îÄ Show source Score
‚îú‚îÄ Add strengths/weaknesses
‚îú‚îÄ Explain format choice better
‚îî‚îÄ Test: See actionable insights
```

---

## üìä –û–¶–ï–ù–ö–ê:
```
Bug Severity:
üî¥ Bug #4 (Infinite loop): CRITICAL - blocks everything
üü° Bug #1 (Auto-analysis): HIGH - bad UX
üü° Bug #2 (Language): HIGH - confusing
üü° Bug #3 (Useless analysis): MEDIUM - not helpful

Fix Time Estimate:
Bug #4: 1-2 hours (need proper endpoint)
Bug #1: 15 minutes
Bug #2: 30 minutes
Bug #3: 30 minutes

Total: 2-3 hours to fix all